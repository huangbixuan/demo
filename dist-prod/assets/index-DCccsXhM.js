import{aU as T,d as Q,z as W,r as i,R as X,c as U,o as v,h as p,w as y,B as Y,C as Z,a as t,O as E,g as h,t as ee,x as A,J as F,M as le,l as H,P as ae,F as re,q as ie,s as te,_ as ue}from"./index-QQaZ7rbf.js";import{_ as ne}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import{_ as se}from"./main.vue_vue_type_script_setup_true_lang-CdYlBeNF.js";import ce from"./MenuEditor-CzE4ZG7T.js";import pe from"./MenuPreviewer-BnpZZ7MY.js";import{h as de}from"./tree-Bh1o0y0-.js";import"./index-D_95hI5s.js";import"./index-CKlW-SbG.js";import"./main-DihDTKAv.js";import"./TabNews-mo0oRnuR.js";import"./main-B8cmAKC9.js";import"./el-image-DHi7RmhO.js";import"./main-BSp1ppd9.js";import"./index.vue_vue_type_script_setup_true_lang-CtP16Cnh.js";import"./index-BctfKmg_.js";import"./main-CZZklA9W.js";import"./main.vue_vue_type_script_setup_true_lang-CtNEQeQ-.js";import"./index-BvM_QHiW.js";import"./index-COkZqY69.js";import"./formatTime-esrXlwGe.js";import"./TabText.vue_vue_type_script_setup_true_lang-GGhtc3Am.js";import"./TabImage-DEdi2Zg_.js";import"./useUpload-uA0mAQ_g.js";import"./TabVoice-CyqrFiNP.js";import"./TabVideo-C--YXe8L.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-Czrc2u0K.js";const oe={class:"clearfix public-account-management"},me={class:"left"},ve={class:"weixin-hd"},ye={class:"weixin-title"},he={class:"clearfix weixin-menu"},fe={class:"save_div"},Me={key:0,class:"right"},_e={key:1,class:"right"},xe=[(x=>(ie("data-v-7c07e4e0"),x=x(),te(),x))(()=>h("p",null,"\u8BF7\u9009\u62E9\u83DC\u5355\u914D\u7F6E",-1))],k="__MENU_NOT_SELECTED__",Ue=ue(Q({name:"MpMenu",__name:"index",setup(x){const d=W(),u=i(!1),o=i(-1),q=i(""),n=i([]),f=i(k),g=i(-1),M=i(!1),b=i(!0),s=i({}),r=i({grand:"0",x:0,y:0}),L=i(!1),O=(l,e)=>{o.value=l,q.value=e,I()},I=async()=>{u.value=!1;try{const l=await(a=>T.get({url:"/mp/menu/list?accountId="+a}))(o.value),e=P(l);n.value=de(e,"id")}finally{u.value=!1}},P=l=>{if(!l)return[];const e=[];return l.forEach(a=>{const m={...a};m.reply={type:a.replyMessageType,accountId:a.accountId,content:a.replyContent,mediaId:a.replyMediaId,url:a.replyMediaUrl,title:a.replyTitle,description:a.replyDescription,thumbMediaId:a.replyThumbMediaId,thumbMediaUrl:a.replyThumbMediaUrl,articles:a.replyArticles,musicUrl:a.replyMusicUrl,hqMusicUrl:a.replyHqMusicUrl},e.push(m)}),e},R=()=>{f.value=k,g.value=-1,M.value=!1,s.value={},r.value={grand:"0",x:0,y:0},L.value=!1},z=async()=>{var l;try{await d.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),r.value.grand==="1"?n.value.splice(r.value.x,1):r.value.grand==="2"&&((l=n.value[r.value.x].children)==null||l.splice(r.value.y,1)),d.notifySuccess("\u5220\u9664\u6210\u529F"),s.value={},M.value=!1,f.value=k}catch{}},B=async()=>{try{await d.confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417?"),u.value=!0,await((l,e)=>T.post({url:"/mp/menu/save",data:{accountId:l,menus:e}}))(o.value,G()),I(),d.notifySuccess("\u53D1\u5E03\u6210\u529F")}finally{u.value=!1}},J=async()=>{try{await d.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),u.value=!0,await(l=>T.delete({url:"/mp/menu/delete?accountId="+l}))(o.value),R(),I(),d.notifySuccess("\u6E05\u7A7A\u6210\u529F")}finally{u.value=!1}},G=()=>{const l=[];return n.value.forEach(e=>{const a=V(e);l.push(a),!e.children||e.children.length<=0||(a.children=[],e.children.forEach(m=>{a.children.push(V(m))}))}),l},V=l=>{let e={...l,children:void 0,reply:void 0};return e.replyMessageType=l.reply.type,e.replyContent=l.reply.content,e.replyMediaId=l.reply.mediaId,e.replyMediaUrl=l.reply.url,e.replyTitle=l.reply.title,e.replyDescription=l.reply.description,e.replyThumbMediaId=l.reply.thumbMediaId,e.replyThumbMediaUrl=l.reply.thumbMediaUrl,e.replyArticles=l.reply.articles,e.replyMusicUrl=l.reply.musicUrl,e.replyHqMusicUrl=l.reply.hqMusicUrl,e};return(l,e)=>{const a=Z,m=Y,S=ne,D=le,$=X("hasPermi"),K=ae;return v(),U(re,null,[p(S,null,{default:y(()=>[p(m,{class:"-mb-15px",ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:y(()=>[p(a,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:y(()=>[p(t(se),{onChange:O})]),_:1})]),_:1},512)]),_:1}),p(S,null,{default:y(()=>[E((v(),U("div",oe,[h("div",me,[h("div",ve,[h("div",ye,ee(t(q)),1)]),h("div",he,[p(pe,{modelValue:t(n),"onUpdate:modelValue":e[0]||(e[0]=c=>A(n)?n.value=c:null),"account-id":t(o),"active-index":t(f),"parent-index":t(g),onMenuClicked:e[1]||(e[1]=(c,w)=>((C,_)=>{M.value=!0,s.value=C,r.value.grand="1",r.value.x=_,b.value=!0,f.value=`${_}`,g.value=_})(c,w)),onSubmenuClicked:e[2]||(e[2]=(c,w,C)=>((_,N,j)=>{M.value=!0,s.value=_,r.value.grand="2",r.value.x=N,r.value.y=j,b.value=!1,f.value=`${N}-${j}`})(c,w,C))},null,8,["modelValue","account-id","active-index","parent-index"])]),h("div",fe,[E((v(),F(D,{class:"save_btn",type:"success",onClick:B},{default:y(()=>[H("\u4FDD\u5B58\u5E76\u53D1\u5E03\u83DC\u5355")]),_:1})),[[$,["mp:menu:save"]]]),E((v(),F(D,{class:"save_btn",type:"danger",onClick:J},{default:y(()=>[H("\u6E05\u7A7A\u83DC\u5355")]),_:1})),[[$,["mp:menu:delete"]]])])]),t(M)?(v(),U("div",Me,[p(ce,{"account-id":t(o),"is-parent":t(b),modelValue:t(s),"onUpdate:modelValue":e[3]||(e[3]=c=>A(s)?s.value=c:null),onDelete:z},null,8,["account-id","is-parent","modelValue"])])):(v(),U("div",_e,xe))])),[[K,t(u)]])]),_:1})],64)}}}),[["__scopeId","data-v-7c07e4e0"]]);export{Ue as default};
