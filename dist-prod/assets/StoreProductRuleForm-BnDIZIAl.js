import{aU as R,d as te,e as se,z as re,r as o,A as de,J as b,o as i,w as e,O as oe,B as ce,a as r,h as a,c as J,i as B,m as ie,E as ne,C as pe,S as me,F as E,G,g as z,t as I,N as ve,k as fe,l as p,M as _e,x as M,P as Ve,_ as ye}from"./index-QQaZ7rbf.js";import{_ as ge}from"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";const be=async m=>await R.get({url:"/product/store-product-rule/page",params:m}),L=async(m,A)=>await R.post({url:"/product/store-product-rule/save/"+A,data:m}),ke=async m=>await R.delete({url:"/product/store-product-rule/delete?id="+m}),he={class:"acea-row row-middle",style:{display:"block",width:"100%"}},we={class:"mr5"},T=ye(te({__name:"StoreProductRuleForm",emits:["success"],setup(m,{expose:A,emit:W}){const{t:k}=se(),C=re(),h=o(!1),v=o(""),f=o(""),_=o(!1),P=o(""),V=o(!1),q=o(""),t=o({id:0,ruleName:"",ruleValue:[]}),D=de({ruleName:[{required:!0,message:"\u89C4\u683C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ruleValue:[{required:!0,message:"\u89C4\u683C\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),x=o();A({open:async(s,l)=>{if(_.value=!0,P.value=k("action."+s),q.value=s,Q(),l){V.value=!0;try{t.value=await(async d=>await R.get({url:"/product/store-product-rule/get?id="+d}))(l)}finally{V.value=!1}}}});const H=W,K=async()=>{if(x&&await x.value.validate()){V.value=!0;try{const s=t.value;q.value==="create"?(await L(s,0),C.success(k("common.createSuccess"))):(await L(s,s.id),C.success(k("common.updateSuccess"))),_.value=!1,H("success")}finally{V.value=!1}}},Q=()=>{var s;t.value={id:void 0,ruleName:void 0,ruleValue:[]},(s=x.value)==null||s.resetFields()},X=()=>{h.value=!0},Y=()=>{if(v.value&&f.value){let l={value:v.value,detail:[f.value]};t.value.ruleValue.push(l);var s={};t.value.ruleValue=t.value.ruleValue.reduce(function(d,c){return!s[c.value]&&(s[c.value]=d.push(c)),d},[]),v.value="",f.value="",h.value=!1}else C.success(k("shop.productRuleAdd"))},Z=()=>{h.value=!1};return(s,l)=>{const d=me,c=pe,w=ne,F=ie,$=ve,ee=fe,y=_e,ae=ce,le=ge,ue=Ve;return i(),b(le,{title:r(P),modelValue:r(_),"onUpdate:modelValue":l[4]||(l[4]=u=>M(_)?_.value=u:null),width:"1000px"},{footer:e(()=>[a(y,{onClick:K,type:"primary",disabled:r(V)},{default:e(()=>[p("\u786E \u5B9A")]),_:1},8,["disabled"]),a(y,{onClick:l[3]||(l[3]=u=>_.value=!1)},{default:e(()=>[p("\u53D6 \u6D88")]),_:1})]),default:e(()=>[oe((i(),b(ae,{ref_key:"formRef",ref:x,model:r(t),rules:r(D),"label-width":"92px",inline:!0},{default:e(()=>[a(F,{gutter:20},{default:e(()=>[a(w,{class:"mb15"},{default:e(()=>[a(c,{label:"\u89C4\u683C\u540D\u79F0",prop:"ruleName"},{default:e(()=>[a(d,{modelValue:r(t).ruleName,"onUpdate:modelValue":l[0]||(l[0]=u=>r(t).ruleName=u),placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(i(!0),J(E,null,G(r(t).ruleValue,(u,O)=>(i(),b(F,{gutter:20,key:O},{default:e(()=>[a(c,{label:" "},{default:e(()=>[z("div",he,[z("span",we,I(u.value),1),a($,{icon:"ep:circle-close",onClick:g=>(n=>{t.value.ruleValue.splice(n,1)})(O)},null,8,["onClick"])]),z("div",null,[(i(!0),J(E,null,G(u.detail,(g,n)=>(i(),b(ee,{class:"mb5",style:{margin:"2px 4px 2px 0"},closable:"",name:g,key:n,onClose:N=>((S,U)=>{S.splice(U,1)})(u.detail,n)},{default:e(()=>[p(I(g),1)]),_:2},1032,["name","onClose"]))),128)),a(d,{placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027\u540D\u79F0",modelValue:u.detail.attrsVal,"onUpdate:modelValue":g=>u.detail.attrsVal=g,style:{width:"170px"}},{append:e(()=>[a(y,{type:"primary",onClick:g=>((n,N)=>{if(n){t.value.ruleValue[N].detail.push(n);var S={};t.value.ruleValue[N].detail=t.value.ruleValue[N].detail.reduce(function(U,j){return!S[j]&&(S[j]=U.push(j)),U},[])}else C.success(k("shop.productRuleAttrAdd"))})(u.detail.attrsVal,O)},{default:e(()=>[p("\u6DFB\u52A0")]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),_:2},1024))),128)),r(h)?(i(),b(F,{key:0,gutter:20},{default:e(()=>[a(w,{span:9,class:"mr15"},{default:e(()=>[a(c,{label:"\u89C4\u683C\uFF1A"},{default:e(()=>[a(d,{placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C",modelValue:r(v),"onUpdate:modelValue":l[1]||(l[1]=u=>M(v)?v.value=u:null)},null,8,["modelValue"])]),_:1})]),_:1}),a(w,{span:9,class:"mr20"},{default:e(()=>[a(c,{label:"\u89C4\u683C\u503C\uFF1A"},{default:e(()=>[a(d,{modelValue:r(f),"onUpdate:modelValue":l[2]||(l[2]=u=>M(f)?f.value=u:null),placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C\u503C"},null,8,["modelValue"])]),_:1})]),_:1}),a(w,{span:2},{default:e(()=>[a(y,{type:"primary",onClick:Y},{default:e(()=>[p("\u786E\u5B9A")]),_:1})]),_:1}),a(w,{span:2},{default:e(()=>[a(y,{onClick:Z},{default:e(()=>[p("\u53D6\u6D88")]),_:1})]),_:1})]),_:1})):B("",!0),r(h)?B("",!0):(i(),b(y,{key:1,type:"primary",onClick:X,class:"ml95 mt10"},{default:e(()=>[p("\u6DFB\u52A0\u65B0\u89C4\u683C")]),_:1}))]),_:1},8,["model","rules"])),[[ue,r(V)]])]),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-0990904a"]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as S,Ce as a,ke as d,be as g};
