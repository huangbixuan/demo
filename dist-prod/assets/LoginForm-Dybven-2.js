import{d as I,e as R,r as m,u as j,a3 as q,a4 as A,a,A as B,as as H,f as J,O as K,a7 as D,J as _,o as F,w as n,h as o,m as Q,E as W,C as X,i as Y,S as Z,T as $,a5 as ee,l as ae,t as oe,B as le,a8 as ne,ac as te,ad as b,ae as re,af as se,aa as ie,ag as pe,ah as de,_ as me}from"./index-QQaZ7rbf.js";import{_ as ue}from"./Verify-C8ESpzp5.js";import{_ as ce}from"./XButton-C609XjEW.js";import{u as ge,L as fe,_ as he,a as we}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-C5h-lCN8.js";import{u as v}from"./useIcon-DeqZzk7G.js";import{r as g}from"./formRules-C_yg8zTD.js";const ye=me(I({__name:"LoginForm",setup(xe){const{t:p}=R(),V=v({icon:"ep:avatar"}),N=v({icon:"ep:lock"}),f=m(),{validForm:k}=we(f),{getLoginState:E}=ge(),{currentRoute:M,push:z}=j(),L=q(),d=m(""),u=m(!1),h=m(),P=m("blockPuzzle"),S=A(()=>a(E)===fe.LOGIN),T={tenantName:[g],username:[g],password:[g]},e=B({isShowPassword:!1,captchaEnable:"true",tenantEnable:"true",loginForm:{tenantName:"yshop",username:"admin",password:"admin123",captchaVerification:"",rememberMe:!1}}),w=async()=>{e.captchaEnable==="false"?await y({}):h.value.show()},y=async t=>{u.value=!0;try{if(await(async()=>{if(e.tenantEnable==="true"){const s=await pe(e.loginForm.tenantName);de(s)}})(),!await k())return;e.loginForm.captchaVerification=t.captchaVerification;const l=await te(e.loginForm);if(!l)return;b.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),e.loginForm.rememberMe?re(e.loginForm):se(),ie(l),d.value||(d.value="/"),d.value.indexOf("sso")!==-1?window.location.href=window.location.href.replace("/login?redirect=",""):z({path:d.value||L.addRouters[0].path})}catch{u.value=!1}finally{setTimeout(()=>{b.service().close()},400)}};return H(()=>M.value,t=>{var l;d.value=(l=t==null?void 0:t.query)==null?void 0:l.redirect},{immediate:!0}),J(()=>{(()=>{const t=ne();t&&(e.loginForm={...e.loginForm,username:t.username?t.username:e.loginForm.username,password:t.password?t.password:e.loginForm.password,rememberMe:!!t.rememberMe,tenantName:t.tenantName?t.tenantName:e.loginForm.tenantName})})()}),(t,l)=>{const s=X,i=W,c=Z,U=ee,x=Q,O=ce,C=ue,G=le;return K((F(),_(G,{ref_key:"formLogin",ref:f,model:a(e).loginForm,rules:T,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:n(()=>[o(x,{style:{"maring-left":"-10px","maring-right":"-10px"}},{default:n(()=>[o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:n(()=>[o(s,null,{default:n(()=>[o(he,{style:{width:"100%"}})]),_:1})]),_:1}),o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:n(()=>[a(e).tenantEnable==="true"?(F(),_(s,{key:0,prop:"tenantName"},{default:n(()=>[o(c,{modelValue:a(e).loginForm.tenantName,"onUpdate:modelValue":l[0]||(l[0]=r=>a(e).loginForm.tenantName=r),placeholder:a(p)("login.tenantNamePlaceholder"),"prefix-icon":t.iconHouse,type:"primary",link:""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):Y("",!0)]),_:1}),o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:n(()=>[o(s,{prop:"username"},{default:n(()=>[o(c,{modelValue:a(e).loginForm.username,"onUpdate:modelValue":l[1]||(l[1]=r=>a(e).loginForm.username=r),placeholder:a(p)("login.usernamePlaceholder"),"prefix-icon":a(V)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:n(()=>[o(s,{prop:"password"},{default:n(()=>[o(c,{modelValue:a(e).loginForm.password,"onUpdate:modelValue":l[2]||(l[2]=r=>a(e).loginForm.password=r),placeholder:a(p)("login.passwordPlaceholder"),"prefix-icon":a(N),"show-password":"",type:"password",onKeyup:l[3]||(l[3]=$(r=>w(),["enter"]))},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px","margin-top":"-20px","margin-bottom":"-20px"}},{default:n(()=>[o(s,null,{default:n(()=>[o(x,{justify:"space-between",style:{width:"100%"}},{default:n(()=>[o(i,{span:6},{default:n(()=>[o(U,{modelValue:a(e).loginForm.rememberMe,"onUpdate:modelValue":l[4]||(l[4]=r=>a(e).loginForm.rememberMe=r)},{default:n(()=>[ae(oe(a(p)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(i,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:n(()=>[o(s,null,{default:n(()=>[o(O,{loading:a(u),title:a(p)("login.login"),class:"w-[100%]",type:"primary",onClick:l[5]||(l[5]=r=>w())},null,8,["loading","title"])]),_:1})]),_:1}),o(C,{ref_key:"verify",ref:h,captchaType:a(P),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:y},null,8,["captchaType"])]),_:1})]),_:1},8,["model"])),[[D,a(S)]])}}}),[["__scopeId","data-v-49137655"]]);export{ye as default};
