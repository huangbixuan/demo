import{d as z,e as B,z as J,r as o,A as O,J as g,o as C,w as l,O as P,B as q,a as d,h as s,C as D,k as G,l as c,t as V,da as L,c2 as Q,x as y,P as T,M as W,_ as X}from"./index-QQaZ7rbf.js";import{_ as Y}from"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import{d as Z,h as $}from"./tree-Bh1o0y0-.js";import{g as ee}from"./index-D4W76Tl3.js";import{g as ae,a as le}from"./index-CLwSlqhw.js";import{E as se}from"./index-D_95hI5s.js";const te=X(z({name:"SystemRoleAssignMenuForm",__name:"RoleAssignMenuForm",emits:["success"],setup(de,{expose:b,emit:w}){const{t:I}=B(),R=J(),n=o(!1),i=o(!1),t=O({id:void 0,name:"",code:"",menuIds:[]}),p=o(),_=o([]),m=o(!1),u=o(),v=o(!1);b({open:async a=>{n.value=!0,F(),_.value=$(await ee()),t.id=a.id,t.name=a.name,t.code=a.code,i.value=!0;try{t.value.menuIds=await ae(a.id),t.value.menuIds.forEach(e=>{u.value.setChecked(e,!0,!1)})}finally{i.value=!1}}});const M=w,A=async()=>{if(p&&await p.value.validate()){i.value=!0;try{const a={roleId:t.id,menuIds:[...u.value.getCheckedKeys(!1),...u.value.getHalfCheckedKeys()]};await le(a),R.success(I("common.updateSuccess")),n.value=!1,M("success")}finally{i.value=!1}}},F=()=>{var a,e;v.value=!1,m.value=!1,t.value={id:void 0,name:"",code:"",menuIds:[]},(a=u.value)==null||a.setCheckedNodes([]),(e=p.value)==null||e.resetFields()},U=()=>{u.value.setCheckedNodes(v.value?_.value:[])},E=()=>{var e;const a=(e=u.value)==null?void 0:e.store.nodesMap;for(let f in a)a[f].expanded!==m.value&&(a[f].expanded=m.value)};return(a,e)=>{const f=G,h=D,k=Q,H=L,K=se,N=q,x=W,S=Y,j=T;return C(),g(S,{modelValue:d(n),"onUpdate:modelValue":e[3]||(e[3]=r=>y(n)?n.value=r:null),title:"\u83DC\u5355\u6743\u9650"},{footer:l(()=>[s(x,{disabled:d(i),type:"primary",onClick:A},{default:l(()=>[c("\u786E \u5B9A")]),_:1},8,["disabled"]),s(x,{onClick:e[2]||(e[2]=r=>n.value=!1)},{default:l(()=>[c("\u53D6 \u6D88")]),_:1})]),default:l(()=>[P((C(),g(N,{ref_key:"formRef",ref:p,model:d(t),"label-width":"80px"},{default:l(()=>[s(h,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[s(f,null,{default:l(()=>[c(V(d(t).name),1)]),_:1})]),_:1}),s(h,{label:"\u89D2\u8272\u6807\u8BC6"},{default:l(()=>[s(f,null,{default:l(()=>[c(V(d(t).code),1)]),_:1})]),_:1}),s(h,{label:"\u83DC\u5355\u6743\u9650"},{default:l(()=>[s(K,{class:"cardHeight"},{header:l(()=>[c(" \u5168\u9009/\u5168\u4E0D\u9009: "),s(k,{modelValue:d(v),"onUpdate:modelValue":e[0]||(e[0]=r=>y(v)?v.value=r:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:U},null,8,["modelValue"]),c(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: "),s(k,{modelValue:d(m),"onUpdate:modelValue":e[1]||(e[1]=r=>y(m)?m.value=r:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:E},null,8,["modelValue"])]),default:l(()=>[s(H,{ref_key:"treeRef",ref:u,data:d(_),props:d(Z),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019","node-key":"id","show-checkbox":""},null,8,["data","props"])]),_:1})]),_:1})]),_:1},8,["model"])),[[j,d(i)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-a5ae28aa"]]);export{te as default};
