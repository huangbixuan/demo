import{d as O,z as Q,r as n,a4 as L,f as W,c as U,o as D,F as X,h as i,cm as Y,a as l,x as R,w as u,B as Z,g as e,$ as V,C as ee,S as ae,m as se,E as le,l as g,t as h,M as te,N as ie,q as ce,s as de,_ as oe}from"./index-QQaZ7rbf.js";import{E as re}from"./el-empty-DtZU1JEc.js";import{_ as ne,a as ue,b as me,c as ve}from"./slipay-ClwQEZyt.js";import{_ as pe}from"./UserSelect.vue_vue_type_script_setup_true_name_User_lang-DgBr_L2D.js";import fe from"./payResult-B3JXS29c.js";import ye from"./scanPay-DpRycoM8.js";import{f as he,p as ke}from"./index-DCAaTwVR.js";import"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import"./index.vue_vue_type_script_setup_true_lang-CtP16Cnh.js";import"./index-BctfKmg_.js";import"./el-image-DHi7RmhO.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import"./index-D_95hI5s.js";import"./formatTime-esrXlwGe.js";import"./index-aKI4neIb.js";const t=k=>(ce("data-v-4d9753e0"),k=k(),de(),k),_e={class:"settlement"},ge={class:"left"},we=t(()=>e("div",{class:"title"},"\u8BF7\u9009\u62E9\u652F\u4ED8\u65B9\u5F0F",-1)),xe={class:"content"},Ce=[t(()=>e("img",{class:"icon",src:ne},null,-1)),t(()=>e("div",{class:"name"},"\u73B0\u91D1\u652F\u4ED8",-1))],be=[t(()=>e("img",{class:"icon",src:ue},null,-1)),t(()=>e("div",{class:"name"},"\u4F59\u989D\u652F\u4ED8",-1))],Ie=[t(()=>e("img",{class:"icon",src:me},null,-1)),t(()=>e("div",{class:"name"},"\u5FAE\u4FE1\u652F\u4ED8",-1))],Ve=[t(()=>e("img",{class:"icon",src:ve},null,-1)),t(()=>e("div",{class:"name"},"\u652F\u4ED8\u5B9D\u652F\u4ED8",-1))],Fe={class:"main"},Ue=t(()=>e("div",{class:"title"},"\u7ED3\u7B97\u4FE1\u606F",-1)),De={class:"content"},Re={class:"remark-info"},Te=t(()=>e("div",null,"\u5907\u6CE8\u4FE1\u606F\uFF1A",-1)),ze={class:"discount-info"},Ee=t(()=>e("div",null,"\u4F18\u60E0:\uFF08\u5143\uFF09",-1)),Ne={class:"amount-info"},Se={class:"discount-amount"},Me={class:"value"},je={class:"pay-amount"},Le={class:"value"},Pe={class:"right"},qe=t(()=>e("div",{class:"title"},"\u4F1A\u5458\u4FE1\u606F",-1)),Be={class:"content"},$e={key:0,class:"member-info"},Ae=["src"],Ge={class:"item"},He=t(()=>e("div",{class:"head"},"\u540D\u79F0\uFF1A",-1)),Je={class:"value"},Ke={class:"item"},Oe=t(()=>e("div",{class:"head"},"\u624B\u673A\u53F7\uFF1A",-1)),Qe={class:"value"},We={class:"item"},Xe=t(()=>e("div",{class:"head"},"\u53EF\u7528\u4F59\u989D\uFF1A",-1)),Ye={class:"value"},Ze={class:"item"},ea=t(()=>e("div",{class:"head"},"\u53EF\u7528\u79EF\u5206\uFF1A",-1)),aa={class:"value"},sa={key:1,class:"guest"},la=oe(O({__name:"settlement",props:{cartData:{},shopId:{}},emits:["getCartList"],setup(k,{expose:P,emit:q}){Q();const p=n(!1),o=n("cash");n(0);const y=n(0),w=n(""),c=n({}),x=n(""),C=k,b=s=>{o.value=s},T=L(()=>{let s=C.cartData.reduce((a,r)=>a+r.cartNum*r.price,0);return parseFloat(s).toFixed(2)}),B=L(()=>{let s=T.value-y.value;return parseFloat(s).toFixed(2)});P({open:async()=>{p.value=!0,c.value={}}});const z=n(),$=async s=>{c.value=s},A=q,E=n(),N=n(),S=()=>{p.value=!1},M=async s=>{try{await ke({uni:x.value,from:"scan",paytype:o.value,uid:c.value.id?c.value.id:0,authCode:s,cartIds:[]}),E.value.open()}catch{return}};return W(()=>{let s,a,r,f,m="";document.onkeypress=v=>{if(window.event?f=v.keyCode:v.which&&(f=v.which),f===13)return m.length<3?void 0:(o.value!="weixin"&&o.value!="alipay"||p.value||M(m),m="",r="",s="",!0);a=new Date().getTime(),s||r||(m+=v.key),r&&s&&a-s>30?m=v.key:r&&s&&(m+=v.key),r=f,s=a}}),(s,a)=>{const r=ae,f=ee,m=le,v=se,G=re,H=ie,F=te,J=Z,K=Y;return D(),U(X,null,[i(K,{title:"\u652F\u4ED8\u7ED3\u7B97",modelValue:l(p),"onUpdate:modelValue":a[9]||(a[9]=d=>R(p)?p.value=d:null),width:"1100px",onClose:S,"destroy-on-close":""},{footer:u(()=>[e("div",null,[i(F,{type:"primary",onClick:a[7]||(a[7]=d=>(async()=>{let _={uidType:"admin",shopId:C.shopId,productId:[],spec:[],number:[],remark:w.value,mobile:c.value.mobile,orderType:"takein",gettime:0,payType:o.value,deductionPrice:y.value,uid:c.value.id?c.value.id:0,cartIds:[]};C.cartData.forEach((I,ta)=>{_.productId.push(I.productId),_.spec.push(I.sku),_.number.push(I.cartNum),_.cartIds.push(I.id)});const j=await he(_);j&&(x.value=j.orderId,p.value=!1,A("getCartList",C.shopId),o.value=="weixin"||o.value=="alipay"?N.value.open(x.value,T.value):M(""))})())},{default:u(()=>[g("\u786E\u5B9A\u6536\u6B3E")]),_:1}),i(F,{onClick:a[8]||(a[8]=d=>S())},{default:u(()=>[g("\u53D6 \u6D88")]),_:1})])]),default:u(()=>[i(J,{ref:"form","label-width":"0px"},{default:u(()=>[e("div",_e,[e("div",ge,[we,e("div",xe,[e("div",{class:V("pay-item"+(l(o)=="cash"?" active":"")),onClick:a[0]||(a[0]=d=>b("cash"))},Ce,2),e("div",{class:V("pay-item"+(l(o)=="yue"?" active":"")),onClick:a[1]||(a[1]=d=>b("yue"))},be,2),e("div",{class:V("pay-item"+(l(o)=="weixin"?" active":"")),onClick:a[2]||(a[2]=d=>b("weixin"))},Ie,2),e("div",{class:V("pay-item"+(l(o)=="alipay"?" active":"")),onClick:a[3]||(a[3]=d=>b("alipay"))},Ve,2)])]),e("div",Fe,[Ue,e("div",De,[e("div",Re,[Te,i(f,{class:"form-item",prop:"remark"},{default:u(()=>[i(r,{type:"textarea",modelValue:l(w),"onUpdate:modelValue":a[4]||(a[4]=d=>R(w)?w.value=d:null),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",clearable:""},null,8,["modelValue"])]),_:1})]),e("div",ze,[i(v,null,{default:u(()=>[i(m,{span:12},{default:u(()=>[Ee,i(f,{class:"form-item",prop:"reduce"},{default:u(()=>[i(r,{type:"number",modelValue:l(y),"onUpdate:modelValue":a[5]||(a[5]=d=>R(y)?y.value=d:null),style:{width:"200px"},placeholder:"\u8BF7\u8F93\u5165\u7ACB\u51CF\u91D1\u989D",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),e("div",Ne,[e("span",Se,[g("\u4F18\u60E0\u91D1\u989D\uFF1A\uFFE5"),e("span",Me,h(l(y)),1)]),e("span",je,[g("\u5E94\u4ED8\u91D1\u989D\uFF1A\uFFE5"),e("span",Le,h(l(B)),1)])])])]),e("div",Pe,[qe,e("div",Be,[l(c).nickname?(D(),U("div",$e,[e("img",{class:"avatar",src:l(c).avatar},null,8,Ae),e("div",Ge,[He,e("div",Je,h(l(c).nickname),1)]),e("div",Ke,[Oe,e("div",Qe,h(l(c).mobile?l(c).mobile:"\u672A\u7ED1\u5B9A"),1)]),e("div",We,[Xe,e("div",Ye,h(l(c).nowMoney)+"\uFF08\u5143\uFF09",1)]),e("div",Ze,[ea,e("div",aa,h(l(c).integral),1)])])):(D(),U("div",sa,[i(G,{description:"\u5F53\u524D\u4E3A\u6E38\u5BA2","image-size":30}),i(F,{calss:"do-action",size:"mini",type:"danger",onClick:a[6]||(a[6]=d=>{z.value.open()})},{default:u(()=>[i(H,{icon:"ep:plus",class:"mr-5px"}),g(" \u5173\u8054\u4F1A\u5458")]),_:1})]))])])])]),_:1},512)]),_:1},8,["modelValue"]),i(pe,{ref_key:"UserSelectRef",ref:z,onSaveUser:$},null,512),i(fe,{ref_key:"payResultRef",ref:E,"order-id":l(x)},null,8,["order-id"]),i(ye,{ref_key:"scanPayRef",ref:N},null,512)],64)}}}),[["__scopeId","data-v-4d9753e0"]]);export{la as default};
