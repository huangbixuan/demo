import{d as ta,e as na,z as ra,u as sa,r as w,A as ia,f as pa,R as da,c as L,o as s,h as a,w as e,B as ua,a as o,C as ma,S as ca,T as M,D as fa,F as B,G as ba,U as ya,I,J as i,K as _a,O as c,M as ga,l as p,N as wa,n as ha,p as ka,t as va,i as O,P as xa}from"./index-QQaZ7rbf.js";import{_ as Ca}from"./index.vue_vue_type_script_setup_true_lang-CtP16Cnh.js";import{E as ja,a as Na,b as Sa}from"./el-dropdown-item-D1XCTc1V.js";import{_ as Oa}from"./DictTag.vue_vue_type_script_lang-DFL6gWod.js";import{_ as Ra}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import{c as R}from"./permission-Ggl0UXkd.js";import{_ as Ta}from"./JobForm.vue_vue_type_script_setup_true_lang-BIpcdNeA.js";import{_ as Pa}from"./JobDetail.vue_vue_type_script_setup_true_lang-B4CtezH6.js";import{d as Va}from"./download--D_IyRio.js";import{b as Aa,e as Ua,d as Ja,f as qa,r as za}from"./index-CZ13oIGK.js";import{a as f}from"./constants-D0aoFN3l.js";import"./index-BctfKmg_.js";import"./color-xEzN0Pg5.js";import"./index-D_95hI5s.js";import"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import"./el-descriptions-item-BBtnvGnE.js";import"./el-timeline-item-CFJSbWRQ.js";import"./formatTime-esrXlwGe.js";const Fa=ta({name:"InfraJob",__name:"index",setup(La){const{t:C}=na(),b=ra(),{push:K}=sa(),j=w(!0),T=w(0),P=w([]),r=ia({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),V=w(),N=w(!1),y=async()=>{j.value=!0;try{const t=await Aa(r);P.value=t.list,T.value=t.total}finally{j.value=!1}},k=()=>{r.pageNo=1,y()},D=()=>{V.value.resetFields(),k()},E=async()=>{try{await b.exportConfirm(),N.value=!0;const t=await Ua(r);Va.excel(t,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},A=w(),U=(t,n)=>{A.value.open(t,n)},G=async t=>{try{await b.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+t.name+"?",C("common.reminder")),await za(t.id),b.success("\u6267\u884C\u6210\u529F"),await y()}catch{}},J=w(),H=t=>{J.value.open(t)},q=t=>{K(t&&t>0?"/job/job-log?id="+t:"/job/job-log")};return pa(()=>{y()}),(t,n)=>{const z=ca,v=ma,Q=_a,Y=fa,h=wa,u=ga,W=ua,F=Ra,_=ka,X=Oa,S=Sa,Z=Na,$=ja,aa=ha,ea=Ca,g=da("hasPermi"),la=xa;return s(),L(B,null,[a(F,null,{default:e(()=>[a(W,{class:"-mb-15px",model:o(r),ref_key:"queryFormRef",ref:V,inline:!0,"label-width":"100px"},{default:e(()=>[a(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:e(()=>[a(z,{modelValue:o(r).name,"onUpdate:modelValue":n[0]||(n[0]=l=>o(r).name=l),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:e(()=>[a(Y,{modelValue:o(r).status,"onUpdate:modelValue":n[1]||(n[1]=l=>o(r).status=l),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:e(()=>[(s(!0),L(B,null,ba(o(ya)(o(I).INFRA_JOB_STATUS),l=>(s(),i(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:e(()=>[a(z,{modelValue:o(r).handlerName,"onUpdate:modelValue":n[2]||(n[2]=l=>o(r).handlerName=l),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,null,{default:e(()=>[a(u,{onClick:k},{default:e(()=>[a(h,{icon:"ep:search",class:"mr-5px"}),p(" \u641C\u7D22")]),_:1}),a(u,{onClick:D},{default:e(()=>[a(h,{icon:"ep:refresh",class:"mr-5px"}),p(" \u91CD\u7F6E")]),_:1}),c((s(),i(u,{type:"primary",plain:"",onClick:n[3]||(n[3]=l=>U("create"))},{default:e(()=>[a(h,{icon:"ep:plus",class:"mr-5px"}),p(" \u65B0\u589E ")]),_:1})),[[g,["infra:job:create"]]]),c((s(),i(u,{type:"success",plain:"",onClick:E,loading:o(N)},{default:e(()=>[a(h,{icon:"ep:download",class:"mr-5px"}),p(" \u5BFC\u51FA ")]),_:1},8,["loading"])),[[g,["infra:job:export"]]]),c((s(),i(u,{type:"info",plain:"",onClick:n[4]||(n[4]=l=>q())},{default:e(()=>[a(h,{icon:"ep:zoom-in",class:"mr-5px"}),p(" \u6267\u884C\u65E5\u5FD7 ")]),_:1})),[[g,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(F,null,{default:e(()=>[c((s(),i(aa,{data:o(P)},{default:e(()=>[a(_,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),a(_,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(_,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:e(l=>[a(X,{type:o(I).INFRA_JOB_STATUS,value:l.row.status},null,8,["type","value"])]),_:1}),a(_,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),a(_,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),a(_,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),a(_,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:e(l=>[c((s(),i(u,{type:"primary",link:"",onClick:x=>U("update",l.row.id)},{default:e(()=>[p(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),c((s(),i(u,{type:"primary",link:"",onClick:x=>(async d=>{try{const m=d.status===f.STOP?"\u5F00\u542F":"\u5173\u95ED";await b.confirm("\u786E\u8BA4\u8981"+m+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+d.id+'"\u7684\u6570\u636E\u9879?',C("common.reminder"));const oa=d.status===f.STOP?f.NORMAL:f.STOP;await Ja(d.id,oa),b.success(m+"\u6210\u529F"),await y()}catch{d.status=d.status===f.NORMAL?f.STOP:f.NORMAL}})(l.row)},{default:e(()=>[p(va(l.row.status===o(f).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),c((s(),i(u,{type:"danger",link:"",onClick:x=>(async d=>{try{await b.delConfirm(),await qa(d),b.success(C("common.delSuccess")),await y()}catch{}})(l.row.id)},{default:e(()=>[p(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[g,["infra:job:delete"]]]),c((s(),i($,{onCommand:x=>((d,m)=>{switch(d){case"handleRun":G(m);break;case"openDetail":H(m.id);break;case"handleJobLog":q(m==null?void 0:m.id)}})(x,l.row)},{dropdown:e(()=>[a(Z,null,{default:e(()=>[o(R)(["infra:job:trigger"])?(s(),i(S,{key:0,command:"handleRun"},{default:e(()=>[p(" \u6267\u884C\u4E00\u6B21 ")]),_:1})):O("",!0),o(R)(["infra:job:query"])?(s(),i(S,{key:1,command:"openDetail"},{default:e(()=>[p(" \u4EFB\u52A1\u8BE6\u7EC6 ")]),_:1})):O("",!0),o(R)(["infra:job:query"])?(s(),i(S,{key:2,command:"handleJobLog"},{default:e(()=>[p(" \u8C03\u5EA6\u65E5\u5FD7 ")]),_:1})):O("",!0)]),_:1})]),default:e(()=>[a(u,{type:"primary",link:""},{default:e(()=>[a(h,{icon:"ep:d-arrow-right"}),p(" \u66F4\u591A")]),_:1})]),_:2},1032,["onCommand"])),[[g,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[la,o(j)]]),a(ea,{total:o(T),page:o(r).pageNo,"onUpdate:page":n[5]||(n[5]=l=>o(r).pageNo=l),limit:o(r).pageSize,"onUpdate:limit":n[6]||(n[6]=l=>o(r).pageSize=l),onPagination:y},null,8,["total","page","limit"])]),_:1}),a(Ta,{ref_key:"formRef",ref:A,onSuccess:y},null,512),a(Pa,{ref_key:"detailRef",ref:J},null,512)],64)}}});export{Fa as default};
