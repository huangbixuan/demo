import{d as G,z as j,r as m,aj as F,a4 as w,dg as K,aO as M,f as P,c as h,o as c,h as t,w as r,g as e,k as W,a as s,l as x,t as y,S as q,x as b,M as A,D as B,K as H,F as J,G as N,J as L}from"./index-QQaZ7rbf.js";import{f as Q}from"./formatTime-esrXlwGe.js";import{g as X}from"./index-uPKJ4_LV.js";import{E as Y}from"./index-D_95hI5s.js";const Z={class:"flex"},ee=e("div",{class:"card-header"},[e("span",null,"\u8FDE\u63A5")],-1),ae={class:"flex items-center"},le=e("span",{class:"mr-4 text-lg font-medium"}," \u8FDE\u63A5\u72B6\u6001: ",-1),se=e("hr",{class:"my-4"},null,-1),te={class:"flex"},re=e("p",{class:"mt-4 text-lg font-medium"},"\u6D88\u606F\u8F93\u5165\u6846",-1),ue=e("hr",{class:"my-4"},null,-1),ne=e("div",{class:"card-header"},[e("span",null,"\u6D88\u606F\u8BB0\u5F55")],-1),de={class:"max-h-80 overflow-auto"},oe={class:"flex items-center"},ie=e("span",{class:"text-primary mr-2 font-medium"},"\u6536\u5230\u6D88\u606F:",-1),me=G({name:"InfraWebSocket",__name:"index",setup(ce){const g=j(),p=m("https://meeting.ai-centre.org/infra/ws".replace("http","ws")+"?token="+F()),n=w(()=>k.value==="OPEN"),$=w(()=>n.value?"success":"red"),{status:k,data:d,send:D,close:I,open:R}=K(p.value,{autoReconnect:!1,heartbeat:!0}),v=m([]),T=w(()=>v.value.slice().reverse());M(()=>{if(d.value)try{if(d.value==="pong")return;const o=JSON.parse(d.value),l=o.type,u=JSON.parse(o.content);if(!l)return void g.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+d.value);if(l==="demo-message-receive")return void(u.single?v.value.push({text:`\u3010\u5355\u53D1\u3011\u7528\u6237\u7F16\u53F7(${u.fromUserId})\uFF1A${u.text}`,time:new Date().getTime()}):v.value.push({text:`\u3010\u7FA4\u53D1\u3011\u7528\u6237\u7F16\u53F7(${u.fromUserId})\uFF1A${u.text}`,time:new Date().getTime()}));if(l==="notice-push")return void v.value.push({text:`\u3010\u7CFB\u7EDF\u901A\u77E5\u3011\uFF1A${u.title}`,time:new Date().getTime()});g.error("\u672A\u5904\u7406\u6D88\u606F\uFF1A"+d.value)}catch{g.error("\u5904\u7406\u6D88\u606F\u53D1\u751F\u5F02\u5E38\uFF1A"+d.value)}});const i=m(""),f=m(""),z=()=>{const o=JSON.stringify({text:i.value,toUserId:f.value}),l=JSON.stringify({type:"demo-message-send",content:o});D(l),i.value=""},C=()=>{n.value?I():R()},V=m([]);return P(async()=>{V.value=await X()}),(o,l)=>{const u=W,_=q,O=A,S=H,E=B,U=Y;return c(),h("div",Z,[t(U,{gutter:12,class:"w-1/2",shadow:"always"},{header:r(()=>[ee]),default:r(()=>[e("div",ae,[le,t(u,{color:s($)},{default:r(()=>[x(y(s(k)),1)]),_:1},8,["color"])]),se,e("div",te,[t(_,{modelValue:s(p),"onUpdate:modelValue":l[0]||(l[0]=a=>b(p)?p.value=a:null),disabled:""},{prepend:r(()=>[x("\u670D\u52A1\u5730\u5740")]),_:1},8,["modelValue"]),t(O,{type:s(n)?"danger":"primary",onClick:C},{default:r(()=>[x(y(s(n)?"\u5173\u95ED\u8FDE\u63A5":"\u5F00\u542F\u8FDE\u63A5"),1)]),_:1},8,["type"])]),re,ue,t(_,{modelValue:s(i),"onUpdate:modelValue":l[1]||(l[1]=a=>b(i)?i.value=a:null),autosize:{minRows:2,maxRows:4},disabled:!s(n),clearable:"",type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u4F60\u8981\u53D1\u9001\u7684\u6D88\u606F"},null,8,["modelValue","disabled"]),t(E,{modelValue:s(f),"onUpdate:modelValue":l[2]||(l[2]=a=>b(f)?f.value=a:null),class:"mt-4",placeholder:"\u8BF7\u9009\u62E9\u53D1\u9001\u4EBA"},{default:r(()=>[t(S,{key:"",label:"\u6240\u6709\u4EBA",value:""}),(c(!0),h(J,null,N(s(V),a=>(c(),L(S,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(O,{disabled:!s(n),block:"",class:"ml-2 mt-4",type:"primary",onClick:z},{default:r(()=>[x(" \u53D1\u9001 ")]),_:1},8,["disabled"])]),_:1}),t(U,{gutter:12,class:"w-1/2",shadow:"always"},{header:r(()=>[ne]),default:r(()=>[e("div",de,[e("ul",null,[(c(!0),h(J,null,N(s(T),a=>(c(),h("li",{key:a.time,class:"mt-2"},[e("div",oe,[ie,e("span",null,y(s(Q)(a.time)),1)]),e("div",null,y(a.text),1)]))),128))])])]),_:1})])}}});export{me as default};
