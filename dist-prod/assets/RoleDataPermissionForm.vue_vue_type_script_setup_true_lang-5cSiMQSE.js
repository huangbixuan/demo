import{d as z,e as B,z as G,r as u,A as J,J as y,o as f,w as o,O as Y,i as j,B as q,a,h as s,C as H,k as Q,l as n,t as C,D as W,c as X,F as Z,G as $,U as ee,I as ae,K as le,P as te,da as de,c2 as oe,x as h,M as se,aL as ue}from"./index-QQaZ7rbf.js";import{_ as ce}from"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import{d as ne,h as ie}from"./tree-Bh1o0y0-.js";import{c as D}from"./constants-D0aoFN3l.js";import{a as pe}from"./index-BmQEDQ_i.js";import{b as me}from"./index-CLwSlqhw.js";import{E as re}from"./index-D_95hI5s.js";const ve=z({name:"SystemRoleDataPermissionForm",__name:"RoleDataPermissionForm",emits:["success"],setup(fe,{expose:w,emit:U}){const{t:E}=B(),T=G(),i=u(!1),_=u(!1),d=J({id:void 0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]}),V=u(),x=u([]),p=u(!0),m=u(),r=u(!1),v=u(!0);w({open:async l=>{var e;i.value=!0,P(),x.value=ie(await pe()),d.id=l.id,d.name=l.name,d.code=l.code,d.dataScope=l.dataScope,await ue(),(e=l.dataScopeDeptIds)==null||e.forEach(c=>{m.value.setChecked(c,!0,!1)})}});const I=U,M=async()=>{_.value=!0;try{const l={roleId:d.id,dataScope:d.dataScope,dataScopeDeptIds:d.dataScope!==D.DEPT_CUSTOM?[]:m.value.getCheckedKeys(!1)};await me(l),T.success(E("common.updateSuccess")),i.value=!1,I("success")}finally{_.value=!1}},P=()=>{var l,e;r.value=!1,p.value=!0,v.value=!0,d.value={id:void 0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]},(l=m.value)==null||l.setCheckedNodes([]),(e=V.value)==null||e.resetFields()},F=()=>{var e;const l=(e=m.value)==null?void 0:e.store.nodesMap;for(let c in l)l[c].expanded!==p.value&&(l[c].expanded=p.value)};return(l,e)=>{const c=Q,S=H,R=le,O=W,g=q,k=oe,A=de,K=re,b=se,L=ce,N=te;return f(),y(L,{modelValue:a(i),"onUpdate:modelValue":e[6]||(e[6]=t=>h(i)?i.value=t:null),title:"\u83DC\u5355\u6743\u9650",width:"800"},{footer:o(()=>[s(b,{disabled:a(_),type:"primary",onClick:M},{default:o(()=>[n("\u786E \u5B9A")]),_:1},8,["disabled"]),s(b,{onClick:e[5]||(e[5]=t=>i.value=!1)},{default:o(()=>[n("\u53D6 \u6D88")]),_:1})]),default:o(()=>[Y((f(),y(g,{ref_key:"formRef",ref:V,model:a(d),"label-width":"80px"},{default:o(()=>[s(S,{label:"\u89D2\u8272\u540D\u79F0"},{default:o(()=>[s(c,null,{default:o(()=>[n(C(a(d).name),1)]),_:1})]),_:1}),s(S,{label:"\u89D2\u8272\u6807\u8BC6"},{default:o(()=>[s(c,null,{default:o(()=>[n(C(a(d).code),1)]),_:1})]),_:1}),s(S,{label:"\u6743\u9650\u8303\u56F4"},{default:o(()=>[s(O,{modelValue:a(d).dataScope,"onUpdate:modelValue":e[0]||(e[0]=t=>a(d).dataScope=t)},{default:o(()=>[(f(!0),X(Z,null,$(a(ee)(a(ae).SYSTEM_DATA_SCOPE),t=>(f(),y(R,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[N,a(_)]]),a(d).dataScope===a(D).DEPT_CUSTOM?(f(),y(S,{key:0,label:"\u6743\u9650\u8303\u56F4",style:{display:"flex"}},{default:o(()=>[s(K,{class:"card",shadow:"never"},{header:o(()=>[n(" \u5168\u9009/\u5168\u4E0D\u9009: "),s(k,{modelValue:a(r),"onUpdate:modelValue":e[1]||(e[1]=t=>h(r)?r.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:e[2]||(e[2]=t=>{m.value.setCheckedNodes(r.value?x.value:[])})},null,8,["modelValue"]),n(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: "),s(k,{modelValue:a(p),"onUpdate:modelValue":e[3]||(e[3]=t=>h(p)?p.value=t:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:F},null,8,["modelValue"]),n(" \u7236\u5B50\u8054\u52A8(\u9009\u4E2D\u7236\u8282\u70B9\uFF0C\u81EA\u52A8\u9009\u62E9\u5B50\u8282\u70B9): "),s(k,{modelValue:a(v),"onUpdate:modelValue":e[4]||(e[4]=t=>h(v)?v.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":""},null,8,["modelValue"])]),default:o(()=>[s(A,{ref_key:"treeRef",ref:m,"check-strictly":!a(v),data:a(x),props:a(ne),"default-expand-all":"","empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E","node-key":"id","show-checkbox":""},null,8,["check-strictly","data","props"])]),_:1})]),_:1})):j("",!0)]),_:1},8,["modelValue"])}}});export{ve as _};
