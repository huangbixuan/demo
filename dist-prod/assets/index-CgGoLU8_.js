import{d as ne,z as ie,e as me,r as f,A as ue,f as de,R as pe,c as I,o as n,h as e,w as a,E as ce,B as fe,a as t,C as ye,S as we,T as Y,D as _e,F as H,G as he,U as ge,I as be,J as m,K as ve,L as ke,O as _,M as Ce,l as u,N as Ve,n as xe,p as Se,c2 as Ne,g as Ue,i as U,P as Re,m as Ee}from"./index-QQaZ7rbf.js";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang-CtP16Cnh.js";import{E as Ae,a as De,b as ze}from"./el-dropdown-item-D1XCTc1V.js";import{_ as Be}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import{c as R}from"./permission-Ggl0UXkd.js";import{d as Fe}from"./formatTime-esrXlwGe.js";import{d as Le}from"./download--D_IyRio.js";import{C}from"./constants-D0aoFN3l.js";import{b as Me,d as Pe,e as Ie,f as Ye,r as He}from"./index-uPKJ4_LV.js";import{_ as Ke}from"./UserForm.vue_vue_type_script_setup_true_lang-78pCjirA.js";import{_ as Oe}from"./UserImportForm.vue_vue_type_script_setup_true_lang-CPsnkzXF.js";import{_ as je}from"./UserAssignRoleForm.vue_vue_type_script_setup_true_lang-Cuii_QQF.js";import{_ as qe}from"./DeptTree.vue_vue_type_script_setup_true_lang-Bs_ooOZ7.js";import"./index-BctfKmg_.js";import"./index-D_95hI5s.js";import"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import"./el-tree-select-BtYVvkSk.js";import"./tree-Bh1o0y0-.js";import"./index-BfdFuESF.js";import"./index-BmQEDQ_i.js";import"./index-CLwSlqhw.js";import"./index-SZ6OHa9M.js";const Je={class:"flex items-center justify-center"},Ge=ne({name:"SystemUser",__name:"index",setup(We){const w=ie(),{t:E}=me(),V=f(!0),T=f(0),A=f([]),r=ue({pageNo:1,pageSize:10,username:void 0,mobile:void 0,status:void 0,deptId:void 0,createTime:[]}),D=f(),d=async()=>{V.value=!0;try{const s=await Me(r);A.value=s.list,T.value=s.total}finally{V.value=!1}},k=()=>{r.pageNo=1,d()},K=()=>{var s;(s=D.value)==null||s.resetFields(),k()},O=async s=>{r.deptId=s.id,await d()},z=f(),B=(s,o)=>{z.value.open(s,o)},F=f(),j=()=>{F.value.open()},x=f(!1),q=async()=>{try{await w.exportConfirm(),x.value=!0;const s=await Ie(r);Le.excel(s,"\u7528\u6237\u6570\u636E.xls")}catch{}finally{x.value=!1}},J=async s=>{try{await w.delConfirm(),await Ye(s),w.success(E("common.delSuccess")),await d()}catch{}},G=async s=>{try{const o=(await w.prompt('\u8BF7\u8F93\u5165"'+s.username+'"\u7684\u65B0\u5BC6\u7801',E("common.reminder"))).value;await He(s.id,o),w.success("\u4FEE\u6539\u6210\u529F\uFF0C\u65B0\u5BC6\u7801\u662F\uFF1A"+o)}catch{}},L=f(),W=s=>{L.value.open(s)};return de(()=>{d()}),(s,o)=>{const S=Be,M=ce,P=we,h=ye,Q=ve,X=_e,Z=ke,i=Ve,y=Ce,$=fe,p=Se,ee=Ne,N=ze,ae=De,le=Ae,te=xe,se=Te,oe=Ee,g=pe("hasPermi"),re=Re;return n(),I(H,null,[e(oe,{gutter:20},{default:a(()=>[e(M,{span:4,xs:24},{default:a(()=>[e(S,{class:"h-1/1"},{default:a(()=>[e(qe,{onNodeClick:O})]),_:1})]),_:1}),e(M,{span:20,xs:24},{default:a(()=>[e(S,null,{default:a(()=>[e($,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:D,inline:!0,"label-width":"68px"},{default:a(()=>[e(h,{label:"\u7528\u6237\u540D\u79F0",prop:"username"},{default:a(()=>[e(P,{modelValue:t(r).username,"onUpdate:modelValue":o[0]||(o[0]=l=>t(r).username=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",clearable:"",onKeyup:Y(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,{label:"\u624B\u673A\u53F7\u7801",prop:"mobile"},{default:a(()=>[e(P,{modelValue:t(r).mobile,"onUpdate:modelValue":o[1]||(o[1]=l=>t(r).mobile=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",clearable:"",onKeyup:Y(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,{label:"\u72B6\u6001",prop:"status"},{default:a(()=>[e(X,{modelValue:t(r).status,"onUpdate:modelValue":o[2]||(o[2]=l=>t(r).status=l),placeholder:"\u7528\u6237\u72B6\u6001",clearable:"",class:"!w-240px"},{default:a(()=>[(n(!0),I(H,null,he(t(ge)(t(be).COMMON_STATUS),l=>(n(),m(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:a(()=>[e(Z,{modelValue:t(r).createTime,"onUpdate:modelValue":o[3]||(o[3]=l=>t(r).createTime=l),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(y,{onClick:k},{default:a(()=>[e(i,{icon:"ep:search"}),u("\u641C\u7D22")]),_:1}),e(y,{onClick:K},{default:a(()=>[e(i,{icon:"ep:refresh"}),u("\u91CD\u7F6E")]),_:1}),_((n(),m(y,{type:"primary",plain:"",onClick:o[4]||(o[4]=l=>B("create"))},{default:a(()=>[e(i,{icon:"ep:plus"}),u(" \u65B0\u589E ")]),_:1})),[[g,["system:user:create"]]]),_((n(),m(y,{type:"warning",plain:"",onClick:j},{default:a(()=>[e(i,{icon:"ep:upload"}),u(" \u5BFC\u5165 ")]),_:1})),[[g,["system:user:import"]]]),_((n(),m(y,{type:"success",plain:"",onClick:q,loading:t(x)},{default:a(()=>[e(i,{icon:"ep:download"}),u("\u5BFC\u51FA ")]),_:1},8,["loading"])),[[g,["system:user:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(S,null,{default:a(()=>[_((n(),m(te,{data:t(A)},{default:a(()=>[e(p,{label:"\u7528\u6237\u7F16\u53F7",align:"center",key:"id",prop:"id"}),e(p,{label:"\u7528\u6237\u540D\u79F0",align:"center",prop:"username","show-overflow-tooltip":!0}),e(p,{label:"\u7528\u6237\u6635\u79F0",align:"center",prop:"nickname","show-overflow-tooltip":!0}),e(p,{label:"\u90E8\u95E8",align:"center",key:"deptName",prop:"deptName","show-overflow-tooltip":!0}),e(p,{label:"\u624B\u673A\u53F7\u7801",align:"center",prop:"mobile",width:"120"}),e(p,{label:"\u72B6\u6001",key:"status"},{default:a(l=>[e(ee,{modelValue:l.row.status,"onUpdate:modelValue":b=>l.row.status=b,"active-value":0,"inactive-value":1,onChange:b=>(async c=>{try{const v=c.status===C.ENABLE?"\u542F\u7528":"\u505C\u7528";await w.confirm('\u786E\u8BA4\u8981"'+v+'""'+c.username+'"\u7528\u6237\u5417?'),await Pe(c.id,c.status),await d()}catch{c.status=c.status===C.ENABLE?C.DISABLE:C.ENABLE}})(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(p,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(Fe),width:"180"},null,8,["formatter"]),e(p,{label:"\u64CD\u4F5C",align:"center",width:"160"},{default:a(l=>[Ue("div",Je,[_((n(),m(y,{type:"primary",link:"",onClick:b=>B("update",l.row.id)},{default:a(()=>[e(i,{icon:"ep:edit"}),u("\u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[g,["system:user:update"]]]),_((n(),m(le,{onCommand:b=>((c,v)=>{switch(c){case"handleDelete":J(v.id);break;case"handleResetPwd":G(v);break;case"handleRole":W(v)}})(b,l.row)},{dropdown:a(()=>[e(ae,null,{default:a(()=>[t(R)(["system:user:delete"])?(n(),m(N,{key:0,command:"handleDelete"},{default:a(()=>[e(i,{icon:"ep:delete"}),u("\u5220\u9664 ")]),_:1})):U("",!0),t(R)(["system:user:update-password"])?(n(),m(N,{key:1,command:"handleResetPwd"},{default:a(()=>[e(i,{icon:"ep:key"}),u("\u91CD\u7F6E\u5BC6\u7801 ")]),_:1})):U("",!0),t(R)(["system:permission:assign-user-role"])?(n(),m(N,{key:2,command:"handleRole"},{default:a(()=>[e(i,{icon:"ep:circle-check"}),u("\u5206\u914D\u89D2\u8272 ")]),_:1})):U("",!0)]),_:1})]),default:a(()=>[e(y,{type:"primary",link:""},{default:a(()=>[e(i,{icon:"ep:d-arrow-right"}),u(" \u66F4\u591A")]),_:1})]),_:2},1032,["onCommand"])),[[g,["system:user:delete","system:user:update-password","system:permission:assign-user-role"]]])])]),_:1})]),_:1},8,["data"])),[[re,t(V)]]),e(se,{total:t(T),page:t(r).pageNo,"onUpdate:page":o[5]||(o[5]=l=>t(r).pageNo=l),limit:t(r).pageSize,"onUpdate:limit":o[6]||(o[6]=l=>t(r).pageSize=l),onPagination:d},null,8,["total","page","limit"])]),_:1})]),_:1})]),_:1}),e(Ke,{ref_key:"formRef",ref:z,onSuccess:d},null,512),e(Oe,{ref_key:"importFormRef",ref:F,onSuccess:d},null,512),e(je,{ref_key:"assignRoleFormRef",ref:L,onSuccess:d},null,512)],64)}}});export{Ge as default};
