import{aU as j,d as U,z as W,r as c,A as x,f as A,J as B,o as d,w as O,g as f,O as H,c as y,i as b,h,P as D,a as l,x as E,M as F,l as G,aL as T,q as K,s as Q,_ as X}from"./index-QQaZ7rbf.js";import{_ as Y}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import{R as C}from"./TabNews-mo0oRnuR.js";import Z from"./main-DihDTKAv.js";import $ from"./MsgList-DIhIIgoD.js";import{g as aa}from"./index-DJTZl51b.js";const M=n=>j.get({url:"/mp/message/page",params:n}),R=n=>(K("data-v-e183a7d0"),n=n(),Q(),n),ea={key:0},la=[R(()=>f("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1))],sa={key:1,class:"el-table__empty-block"},ta=[R(()=>f("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1))],ua={class:"msg-send"},V=X(U({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(n){const q=W(),k=n,v=c(-1),m=c(!1),I=c(!0),p=c([]),r=x({pageNo:1,pageSize:14,accountId:v}),i=x({nickname:"\u7528\u6237",avatar:"/assets/profile-BiJdjH9E.jpg",accountId:v}),S=c(!1),e=c({type:C.Text,accountId:-1,articles:[]}),w=c(null),t=c(null);A(async()=>{var s,u;const a=await aa(k.userId);i.nickname=((s=a.nickname)==null?void 0:s.length)>0?a.nickname:i.nickname,i.avatar=((u=i.avatar)==null?void 0:u.length)>0?a.avatar:i.avatar,v.value=a.accountId,e.value.accountId=a.accountId,P()});const J=async()=>{var s;if(!l(e))return;e.value.type===C.News&&e.value.articles&&e.value.articles.length>1&&(e.value.articles=[e.value.articles[0]],q.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(u=>j.post({url:"/mp/message/send",data:u}))({userId:k.userId,...e.value});S.value=!1,p.value=[...p.value,a],await z(),(s=w.value)==null||s.clear()},L=()=>{r.pageNo++,N(r,null)},N=async(a,s=null)=>{var _;m.value=!0;let u=await M(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:k.userId,accountId:a.accountId},s));const g=((_=t.value)==null?void 0:_.scrollHeight)??0,o=u.list.reverse();p.value=[...o,...p.value],m.value=!1,(o.length<r.pageSize||o.length===0)&&(I.value=!1),r.pageNo=a.pageNo,r.pageSize=a.pageSize,r.pageNo===1?await z():o.length!==0&&(await T(),g!==0&&t.value&&(t.value.scrollTop=t.value.scrollHeight-g-100))},P=()=>{N(r)},z=async()=>{await T(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return(a,s)=>{const u=F,g=Y,o=D;return d(),B(g,null,{default:O(()=>[f("div",{class:"msg-div",ref_key:"msgDivRef",ref:t},[H(f("div",null,null,512),[[o,l(m)]]),l(m)?b("",!0):(d(),y("div",ea,[l(I)?(d(),y("div",{key:0,class:"el-table__empty-block",onClick:L},la)):b("",!0),l(I)?b("",!0):(d(),y("div",sa,ta))])),h($,{list:l(p),"account-id":l(v),user:l(i)},null,8,["list","account-id","user"])],512),H((d(),y("div",ua,[h(l(Z),{ref_key:"replySelectRef",ref:w,modelValue:l(e),"onUpdate:modelValue":s[0]||(s[0]=_=>E(e)?e.value=_:null)},null,8,["modelValue"]),h(u,{type:"success",class:"send-but",onClick:J},{default:O(()=>[G("\u53D1\u9001(S)")]),_:1})])),[[o,l(S)]])]),_:1})}}}),[["__scopeId","data-v-e183a7d0"]]),ca=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"}));export{V as W,M as g,ca as m};
