import{d as ae,ai as c,r as S,f as re,a as t,a4 as R,as as $,O as se,P as ce,h as g,n as de,az as K,ar as pe,p as W,_ as ue,e as te,aS as ge,ca as me,c as X,o as P,F as fe,i as L,bL as he,G as we,w as z,ay as Y,J as M,l as N,N as ye,t as q,M as xe,aK as be,A as ve,aq as ne,df as oe,aL as Se}from"./index-QQaZ7rbf.js";import{g as B}from"./Form.vue_vue_type_style_index_0_scoped_348f152a_lang-CNNP2i3c.js";import{E as Pe}from"./index-BctfKmg_.js";import{_ as Ae}from"./Form-D4EiUnE1.js";import{u as ke}from"./useForm-PWYayWvW.js";import{d as Le}from"./download--D_IyRio.js";const ze=ue(ae({name:"Table",props:{pageSize:c.number.def(10),currentPage:c.number.def(1),selection:c.bool.def(!1),showOverflowTooltip:c.bool.def(!0),columns:{type:Array,default:()=>[]},expand:c.bool.def(!1),pagination:{type:Object,default:()=>{}},reserveSelection:c.bool.def(!1),loading:c.bool.def(!1),reserveIndex:c.bool.def(!1),align:c.string.validate(e=>["left","center","right"].includes(e)).def("center"),headerAlign:c.string.validate(e=>["left","center","right"].includes(e)).def("center"),data:{type:Array,default:()=>[]}},emits:["update:pageSize","update:currentPage","register"],setup(e,{attrs:o,slots:p,emit:m,expose:O}){const u=S();re(()=>{const a=t(u);m("register",a==null?void 0:a.$parent,u.value)});const x=S(e.pageSize),f=S(e.currentPage),n=S({}),i=S({}),l=R(()=>{const a={...e};return Object.assign(a,t(i)),a}),b=(a,_)=>{var A;const{columns:T}=t(l);for(const C of _||T)for(const j of a)C.field===j.field?pe(C,j.path,j.value):(A=C.children)!=null&&A.length&&b(a,C.children)},D=S([]),U=a=>{D.value=a};O({setProps:(a={})=>{i.value=Object.assign(t(i),a),n.value=a},setColumn:b,selections:D});const r=R(()=>Object.assign({small:!1,background:!0,pagerCount:document.body.clientWidth<992?5:7,layout:"total, sizes, prev, pager, next, jumper",pageSizes:[10,20,30,50,100],disabled:!1,hideOnSinglePage:!1,total:10},t(l).pagination));$(()=>t(l).pageSize,a=>{x.value=a}),$(()=>t(l).currentPage,a=>{f.value=a}),$(()=>x.value,a=>{m("update:pageSize",a)}),$(()=>f.value,a=>{m("update:currentPage",a)});const v=R(()=>{const a={...o,...e};return delete a.columns,delete a.data,a}),d=()=>{const{selection:a,reserveSelection:_,align:T,headerAlign:A}=t(l);return a?g(W,{type:"selection",reserveSelection:_,align:T,headerAlign:A,width:"50"},null):void 0},w=()=>{const{align:a,headerAlign:_,expand:T}=t(l);return T?g(W,{type:"expand",align:a,headerAlign:_},{default:A=>B(p,"expand",A)}):void 0},E=a=>{const{columns:_,reserveIndex:T,pageSize:A,currentPage:C,align:j,headerAlign:Z,showOverflowTooltip:ie}=t(l);return[w(),d()].concat((a||_).map(s=>{if(s.type==="index")return g(W,{type:"index",index:s.index?s.index:I=>((k,G,H,Q)=>{const J=G+1;return k?H*(Q-1)+J:J})(T,I,A,C),align:s.align||j,headerAlign:s.headerAlign||Z,label:s.label,width:"65px"},null);{const I={...s};return I.children&&delete I.children,g(W,K({showOverflowTooltip:ie,align:j,headerAlign:Z},I,{prop:s.field}),{default:k=>{var G;return s.children&&s.children.length?(H=>{const{align:Q,headerAlign:J,showOverflowTooltip:le}=t(l);return H.map(h=>{const V={...h};return V.children&&delete V.children,g(W,K({showOverflowTooltip:le,align:Q,headerAlign:J},V,{prop:h.field}),{default:F=>{var ee;return h.children&&h.children.length?E(h.children):B(p,h.field,F)||((ee=h==null?void 0:h.formatter)==null?void 0:ee.call(h,F.row,F.column,F.row[h.field],F.$index))||F.row[h.field]},header:B(p,`${h.field}-header`)})})})(s.children):B(p,s.field,k)||((G=s==null?void 0:s.formatter)==null?void 0:G.call(s,k.row,k.column,k.row[s.field],k.$index))||k.row[s.field]},header:()=>B(p,`${s.field}-header`)||s.label})}}))};return()=>se(g("div",null,[g(de,K({ref:u,data:t(l).data,"onSelection-change":U},t(v)),{default:()=>E(),append:()=>B(p,"append")}),t(l).pagination?g(Pe,K({pageSize:x.value,"onUpdate:pageSize":a=>x.value=a,currentPage:f.value,"onUpdate:currentPage":a=>f.value=a,class:"float-right mb-15px mt-15px"},t(r)),null):void 0]),[[ce,t(l).loading]])}}),[["__scopeId","data-v-238f165d"]]),Oe={key:0},_e=ae({name:"Search",__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:c.bool.def(!1),labelWidth:c.oneOfType([String,Number]).def("auto"),layout:c.string.validate(e=>["inline","bottom"].includes(e)).def("inline"),buttomPosition:c.string.validate(e=>["left","center","right"].includes(e)).def("center"),showSearch:c.bool.def(!0),showReset:c.bool.def(!0),expand:c.bool.def(!1),expandField:c.string.def(""),inline:c.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(e,{emit:o}){const{t:p}=te(),m=e,O=o,u=S(!0),x=R(()=>{let r=ge(m.schema);if(m.expand&&m.expandField&&!t(u)){const v=me(r,d=>d.field===m.expandField);if(v>-1){const d=r.length;r.splice(v+1,d)}}return m.layout==="inline"&&(r=r.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),r}),{register:f,elFormRef:n,methods:i}=ke({model:m.model||{}}),l=async()=>{var r;await((r=t(n))==null?void 0:r.validate(async v=>{if(v){const{getFormData:d}=i,w=await d();O("search",w)}}))},b=async()=>{var d;(d=t(n))==null||d.resetFields();const{getFormData:r}=i,v=await r();O("reset",v)},D=R(()=>({textAlign:m.buttomPosition})),U=()=>{var r;(r=t(n))==null||r.resetFields(),u.value=!t(u)};return(r,v)=>{const d=ye,w=xe,E=Ae;return P(),X(fe,null,[g(E,{inline:e.inline,"is-col":e.isCol,"is-custom":!1,"label-width":e.labelWidth,schema:t(x),class:"-mb-15px","hide-required-asterisk":"",onRegister:t(f)},he({action:z(()=>[e.layout==="inline"?(P(),X("div",Oe,[e.showSearch?(P(),M(w,{key:0,onClick:l},{default:z(()=>[g(d,{class:"mr-5px",icon:"ep:search"}),N(" "+q(t(p)("common.query")),1)]),_:1})):L("",!0),e.showReset?(P(),M(w,{key:1,onClick:b},{default:z(()=>[g(d,{class:"mr-5px",icon:"ep:refresh"}),N(" "+q(t(p)("common.reset")),1)]),_:1})):L("",!0),e.expand?(P(),M(w,{key:2,text:"",onClick:U},{default:z(()=>[N(q(t(p)(t(u)?"common.shrink":"common.expand"))+" ",1),g(d,{icon:t(u)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):L("",!0),Y(r.$slots,"actionMore")])):L("",!0)]),_:2},[we(Object.keys(r.$slots),a=>({name:a,fn:z(()=>[Y(r.$slots,a)])}))]),1032,["inline","is-col","label-width","schema","onRegister"]),e.layout==="bottom"?(P(),X("div",{key:0,style:be(t(D))},[e.showSearch?(P(),M(w,{key:0,type:"primary",onClick:l},{default:z(()=>[g(d,{class:"mr-5px",icon:"ep:search"}),N(" "+q(t(p)("common.query")),1)]),_:1})):L("",!0),e.showReset?(P(),M(w,{key:1,onClick:b},{default:z(()=>[g(d,{class:"mr-5px",icon:"ep:refresh-right"}),N(" "+q(t(p)("common.reset")),1)]),_:1})):L("",!0),e.expand?(P(),M(w,{key:2,text:"",onClick:U},{default:z(()=>[N(q(t(p)(t(u)?"common.shrink":"common.expand"))+" ",1),g(d,{icon:t(u)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):L("",!0),Y(r.$slots,"actionMore")],4)):L("",!0)],64)}}}),{t:y}=te(),Te=e=>{const o=ve({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(e==null?void 0:e.defaultParams)||{}},loading:!0,exportLoading:!1,currentRow:null}),p=R(()=>({...o.params,pageSize:o.pageSize,pageNo:o.currentPage}));$(()=>o.currentPage,()=>{f.getList()}),$(()=>o.pageSize,()=>{o.currentPage===1||(o.currentPage=1),f.getList()});const m=S(),O=S(),u=async()=>(await Se(),t(m)),x=async n=>{let i=1;n instanceof Array?(i=n.length,await Promise.all(n.map(async l=>{await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(l)))}))):await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(n))),oe.success(y("common.delSuccess")),o.currentPage=(o.total%o.pageSize===i||o.pageSize===1)&&o.currentPage>1?o.currentPage-1:o.currentPage,await f.getList()},f={getList:async()=>{o.loading=!0;const n=await(e==null?void 0:e.getListApi(t(p)).finally(()=>{o.loading=!1}));n&&(o.tableList=n.list,o.total=n.total??0)},setProps:async(n={})=>{const i=await u();i==null||i.setProps(n)},setColumn:async n=>{const i=await u();i==null||i.setColumn(n)},getSelections:async()=>{const n=await u();return(n==null?void 0:n.selections)||[]},setSearchParams:n=>{o.params=Object.assign(o.params,{pageSize:o.pageSize,pageNo:1,...n}),o.currentPage!==1?o.currentPage=1:f.getList()},delList:async(n,i,l=!0)=>{const b=await u();!i||b!=null&&b.selections.length?l?ne.confirm(y("common.delMessage"),y("common.confirmTitle"),{confirmButtonText:y("common.ok"),cancelButtonText:y("common.cancel"),type:"warning"}).then(async()=>{await x(n)}):await x(n):oe.warning(y("common.delNoData"))},exportList:async n=>{o.exportLoading=!0,ne.confirm(y("common.exportMessage"),y("common.confirmTitle"),{confirmButtonText:y("common.ok"),cancelButtonText:y("common.cancel"),type:"warning"}).then(async()=>{var l;const i=await((l=e==null?void 0:e.exportListApi)==null?void 0:l.call(e,t(p)));i&&Le.excel(i,n)}).finally(()=>{o.exportLoading=!1})}};return e!=null&&e.props&&f.setProps(e.props),{register:(n,i)=>{m.value=n,O.value=i},elTableRef:O,tableObject:o,methods:f,tableMethods:f}};export{_e as _,ze as a,Te as u};
