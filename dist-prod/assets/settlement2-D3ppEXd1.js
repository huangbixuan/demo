import{d as O,z as Q,r as u,f as W,c as U,o as I,F as X,h as i,cm as Y,a as l,x as R,w as d,B as Z,g as e,$ as V,C as ee,S as ae,m as le,E as se,l as w,t as k,M as ie,N as te,q as ce,s as ue,_ as ne}from"./index-QQaZ7rbf.js";import{E as oe}from"./el-empty-DtZU1JEc.js";import{_ as de,a as re,b as ve,c as me}from"./slipay-ClwQEZyt.js";import{_ as pe}from"./UserSelect.vue_vue_type_script_setup_true_name_User_lang-DgBr_L2D.js";import ye from"./payResult-B3JXS29c.js";import fe from"./scanPay-DpRycoM8.js";import{k as ke,p as he}from"./index-DCAaTwVR.js";import"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import"./index.vue_vue_type_script_setup_true_lang-CtP16Cnh.js";import"./index-BctfKmg_.js";import"./el-image-DHi7RmhO.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CerucUbi.js";import"./index-D_95hI5s.js";import"./formatTime-esrXlwGe.js";import"./index-aKI4neIb.js";const s=b=>(ce("data-v-6476bbde"),b=b(),ue(),b),_e={class:"settlement"},we={class:"left"},be=s(()=>e("div",{class:"title"},"\u8BF7\u9009\u62E9\u652F\u4ED8\u65B9\u5F0F",-1)),ge={class:"content"},xe=[s(()=>e("img",{class:"icon",src:de},null,-1)),s(()=>e("div",{class:"name"},"\u73B0\u91D1\u652F\u4ED8",-1))],Ce=[s(()=>e("img",{class:"icon",src:re},null,-1)),s(()=>e("div",{class:"name"},"\u4F59\u989D\u652F\u4ED8",-1))],Ve=[s(()=>e("img",{class:"icon",src:ve},null,-1)),s(()=>e("div",{class:"name"},"\u5FAE\u4FE1\u652F\u4ED8",-1))],Pe=[s(()=>e("img",{class:"icon",src:me},null,-1)),s(()=>e("div",{class:"name"},"\u652F\u4ED8\u5B9D\u652F\u4ED8",-1))],Ue={class:"main"},Ie=s(()=>e("div",{class:"title"},"\u7ED3\u7B97\u4FE1\u606F",-1)),Re={class:"content"},ze={class:"remark-info"},Ee=s(()=>e("div",null,"\u5907\u6CE8\u4FE1\u606F\uFF1A",-1)),Se={class:"discount-info"},De=s(()=>e("div",null,"\u4F18\u60E0:\uFF08\u5143\uFF09",-1)),Me={class:"amount-info"},Te={class:"discount-amount"},Fe={class:"value"},je={class:"pay-amount"},qe={class:"value"},Be={class:"right"},Ne=s(()=>e("div",{class:"title"},"\u4F1A\u5458\u4FE1\u606F",-1)),$e={class:"content"},Ae={key:0,class:"member-info"},Ge=["src"],He={class:"item"},Je=s(()=>e("div",{class:"head"},"\u540D\u79F0\uFF1A",-1)),Ke={class:"value"},Le={class:"item"},Oe=s(()=>e("div",{class:"head"},"\u624B\u673A\u53F7\uFF1A",-1)),Qe={class:"value"},We={class:"item"},Xe=s(()=>e("div",{class:"head"},"\u53EF\u7528\u4F59\u989D\uFF1A",-1)),Ye={class:"value"},Ze={class:"item"},ea=s(()=>e("div",{class:"head"},"\u53EF\u7528\u79EF\u5206\uFF1A",-1)),aa={class:"value"},la={key:1,class:"guest"},sa=ne(O({__name:"settlement2",emits:["success"],setup(b,{expose:j,emit:q}){const B=Q(),p=u(!1),o=u("cash");u(0);const y=u(0),g=u(""),c=u({}),x=u(""),N=u(0),h=u({}),_=u(0),C=t=>{o.value=t};j({open:async t=>{p.value=!0,c.value={},h.value=t,_.value=h.value.payPrice}});const z=u(),$=async t=>{c.value=t},A=()=>{if(y.value>h.value.totalPrice)return B.error("\u4F18\u60E0\u91D1\u989D\u4E0D\u80FD\u5927\u4E8E\u5546\u54C1\u603B\u4EF7"),void(y.value=0);_.value=(h.value.totalPrice-y.value).toFixed(2)},E=u(),S=u(),D=q,M=()=>{p.value=!1},T=async t=>{try{await he({uni:x.value,from:"scan",paytype:o.value,uid:c.value.id?c.value.id:0,authCode:t,cartIds:[]}),D("success"),E.value.open()}catch{return}};return W(()=>{let t,a,r,f,v="";document.onkeypress=m=>{if(window.event?f=m.keyCode:m.which&&(f=m.which),f===13)return v.length<3?void 0:(o.value!="weixin"&&o.value!="alipay"||p.value||T(v),v="",r="",t="",!0);a=new Date().getTime(),t||r||(v+=m.key),r&&t&&a-t>30?v=m.key:r&&t&&(v+=m.key),r=f,t=a}}),(t,a)=>{const r=ae,f=ee,v=se,m=le,G=oe,H=te,P=ie,J=Z,K=Y;return I(),U(X,null,[i(K,{title:"\u652F\u4ED8\u7ED3\u7B97",modelValue:l(p),"onUpdate:modelValue":a[9]||(a[9]=n=>R(p)?p.value=n:null),width:"1100px",onClose:M,"destroy-on-close":""},{footer:d(()=>[e("div",null,[i(P,{type:"primary",onClick:a[7]||(a[7]=n=>(async()=>{let L={id:h.value.id,remark:g.value,mobile:c.value.mobile,payType:o.value,deductionPrice:N.value,uid:c.value.id?c.value.id:0,payPrice:_.value};const F=await ke(L);F&&(x.value=F.orderId,p.value=!1,D("success"),o.value=="weixin"||o.value=="alipay"?S.value.open(x.value,_.value):T(""))})())},{default:d(()=>[w("\u786E\u5B9A\u6536\u6B3E")]),_:1}),i(P,{onClick:a[8]||(a[8]=n=>M())},{default:d(()=>[w("\u53D6 \u6D88")]),_:1})])]),default:d(()=>[i(J,{ref:"form","label-width":"0px"},{default:d(()=>[e("div",_e,[e("div",we,[be,e("div",ge,[e("div",{class:V("pay-item"+(l(o)=="cash"?" active":"")),onClick:a[0]||(a[0]=n=>C("cash"))},xe,2),e("div",{class:V("pay-item"+(l(o)=="yue"?" active":"")),onClick:a[1]||(a[1]=n=>C("yue"))},Ce,2),e("div",{class:V("pay-item"+(l(o)=="weixin"?" active":"")),onClick:a[2]||(a[2]=n=>C("weixin"))},Ve,2),e("div",{class:V("pay-item"+(l(o)=="alipay"?" active":"")),onClick:a[3]||(a[3]=n=>C("alipay"))},Pe,2)])]),e("div",Ue,[Ie,e("div",Re,[e("div",ze,[Ee,i(f,{class:"form-item",prop:"remark"},{default:d(()=>[i(r,{type:"textarea",modelValue:l(g),"onUpdate:modelValue":a[4]||(a[4]=n=>R(g)?g.value=n:null),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",clearable:""},null,8,["modelValue"])]),_:1})]),e("div",Se,[i(m,null,{default:d(()=>[i(v,{span:12},{default:d(()=>[De,i(f,{class:"form-item",prop:"reduce"},{default:d(()=>[i(r,{type:"number",modelValue:l(y),"onUpdate:modelValue":a[5]||(a[5]=n=>R(y)?y.value=n:null),onInput:A,style:{width:"200px"},placeholder:"\u8BF7\u8F93\u5165\u7ACB\u51CF\u91D1\u989D",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),e("div",Me,[e("span",Te,[w("\u4F18\u60E0\u91D1\u989D\uFF1A\uFFE5"),e("span",Fe,k(l(y)),1)]),e("span",je,[w("\u5E94\u4ED8\u91D1\u989D\uFF1A\uFFE5"),e("span",qe,k(l(_)),1)])])])]),e("div",Be,[Ne,e("div",$e,[l(c).nickname?(I(),U("div",Ae,[e("img",{class:"avatar",src:l(c).avatar},null,8,Ge),e("div",He,[Je,e("div",Ke,k(l(c).nickname),1)]),e("div",Le,[Oe,e("div",Qe,k(l(c).mobile?l(c).mobile:"\u672A\u7ED1\u5B9A"),1)]),e("div",We,[Xe,e("div",Ye,k(l(c).nowMoney)+"\uFF08\u5143\uFF09",1)]),e("div",Ze,[ea,e("div",aa,k(l(c).integral),1)])])):(I(),U("div",la,[i(G,{description:"\u5F53\u524D\u4E3A\u6E38\u5BA2","image-size":30}),i(P,{calss:"do-action",size:"mini",type:"danger",onClick:a[6]||(a[6]=n=>{z.value.open()})},{default:d(()=>[i(H,{icon:"ep:plus",class:"mr-5px"}),w(" \u5173\u8054\u4F1A\u5458")]),_:1})]))])])])]),_:1},512)]),_:1},8,["modelValue"]),i(pe,{ref_key:"UserSelectRef",ref:z,onSaveUser:$},null,512),i(ye,{ref_key:"payResultRef",ref:E,"order-id":l(x)},null,8,["order-id"]),i(fe,{ref_key:"scanPayRef",ref:S},null,512)],64)}}}),[["__scopeId","data-v-6476bbde"]]);export{sa as default};
