import{_ as st}from"./Dialog.vue_vue_type_style_index_0_lang-BZRnyNPI.js";import{c as Z,o as L,ay as $,g as rt,O as lt,a7 as pt,i as ht,aK as dt,$ as ct,d as ut,z as mt,r as E,aG as gt,J as ft,w as D,h as O,a as I,x as U,S as yt,M as vt,l as et,_ as _t}from"./index-QQaZ7rbf.js";var bt={"bm-map":["click","dblclick","rightclick","rightdblclick","maptypechange","mousemove","mouseover","mouseout","movestart","moving","moveend","zoomstart","zoomend","addoverlay","addcontrol","removecontrol","removeoverlay","clearoverlays","dragstart","dragging","dragend","addtilelayer","removetilelayer","load","resize","hotspotclick","hotspotover","hotspotout","tilesloaded","touchstart","touchmove","touchend","longpress"],"bm-geolocation":["locationSuccess","locationError"],"bm-overview-map":["viewchanged","viewchanging"],"bm-marker":["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","infowindowclose","infowindowopen","dragstart","dragging","dragend","rightclick"],"bm-polyline":["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"],"bm-polygon":["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"],"bm-circle":["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"],"bm-label":["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","rightclick"],"bm-info-window":["close","open","maximize","restore","clickclose"],"bm-ground":["click","dblclick"],"bm-autocomplete":["onconfirm","onhighlight"],"bm-point-collection":["click","mouseover","mouseout"]};function V(e,n){const p=n||bt[this.$options.name];p&&p.forEach(l=>{let u=l.slice(0,2)==="on"?l.slice(2):l;const i=this.$attrs["on"+u.replace(u[0],u[0].toUpperCase())];i&&e.addEventListener(l,i)})}function R(e,n={}){const{lng:p,lat:l}=n;return new e.Point(p,l)}function A(e,n={}){const{width:p,height:l}=n;return new e.Size(p,l)}function X(e,n={}){const{url:p,size:l,opts:u={}}=n;let i={anchor:u.anchor&&A(e,u.anchor),imageSize:u.imageSize&&A(e,u.imageSize),imageOffset:u.imageOffset&&A(e,u.imageOffset),infoWindowAnchor:u.infoWindowAnchor&&A(e,u.infoWindowAnchor),printImageUrl:u.printImageUrl};return G(i),new e.Icon(p,A(e,l),i)}const it=e=>Object.prototype.toString.call(e).slice(8,-1),G=e=>{Object.keys(e).forEach(n=>{e[n]===void 0&&delete e[n]})};let H={v:"3.0",type:"API"};const z=()=>H;var ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},J={exports:{}};function Q(){}Q.prototype={on:function(e,n,p){var l=this.e||(this.e={});return(l[e]||(l[e]=[])).push({fn:n,ctx:p}),this},once:function(e,n,p){var l=this;function u(){l.off(e,u),n.apply(p,arguments)}return u._=n,this.on(e,u,p)},emit:function(e){for(var n=[].slice.call(arguments,1),p=((this.e||(this.e={}))[e]||[]).slice(),l=0,u=p.length;l<u;l++)p[l].fn.apply(p[l].ctx,n);return this},off:function(e,n){var p=this.e||(this.e={}),l=p[e],u=[];if(l&&n)for(var i=0,t=l.length;i<t;i++)l[i].fn!==n&&l[i].fn._!==n&&u.push(l[i]);return u.length?p[e]=u:delete p[e],this}},J.exports=Q,J.exports.TinyEmitter=Q;var Y=new J.exports,q=(...e)=>Y.on(...e),wt=(...e)=>Y.off(...e),tt=(...e)=>Y.emit(...e);const nt={API:{"2.0":{setMapStyle:"setMapStyle",NavigationControl:"NavigationControl"},"3.0":{setMapStyle:"setMapStyleV2",NavigationControl:"NavigationControl"}},WebGL:{setMapStyle:"setMapStyleV2",NavigationControl:"NavigationControl3D"}},K=e=>{const n=z();return n.type=="WebGL"?nt[n.type][e]:nt[n.type][n.v][e]};let at;new Promise(e=>{at=e});var j=(e,n)=>{const p=e.__vccOpts||e;for(const[l,u]of n)p[l]=u;return p};const xt={name:"bm-map",inheritAttrs:!1,emits:["ready","init","animationed"],props:{ak:{type:String},v:{type:String},type:{type:String},center:{type:[Object,String]},zoom:{type:Number},minZoom:{type:Number},maxZoom:{type:Number},highResolution:{type:Boolean,default:!0},mapClick:{type:Boolean,default:!0},mapType:{type:String},dragging:{type:Boolean,default:!0},scrollWheelZoom:{type:Boolean,default:!1},doubleClickZoom:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},inertialDragging:{type:Boolean,default:!0},continuousZoom:{type:Boolean,default:!0},pinchToZoom:{type:Boolean,default:!0},autoResize:{type:Boolean,default:!0},theme:{type:Array},mapStyle:{type:Object},hasAnimation:{type:Boolean,default:!0},defaultAnimation:{type:Boolean,default:!0},preserveDrawingBuffer:{type:Boolean,default:!1}},watch:{center(e,n){const{map:p,zoom:l}=this;it(e)==="String"&&e!==n&&this.setCenterZoom(p,e,l)},"center.lng"(e,n){const{BMap:p,map:l,zoom:u,center:i}=this;e!==n&&e>=-180&&e<=180&&this.setCenterZoom(l,new p.Point(e,i.lat),u)},"center.lat"(e,n){const{BMap:p,map:l,zoom:u,center:i}=this;e!==n&&e>=-74&&e<=74&&this.setCenterZoom(l,new p.Point(i.lng,e),u)},zoom(e,n){const{map:p}=this;e!==n&&e>=3&&e<=19&&p.setZoom(e)},minZoom(e){const{map:n}=this;n.setMinZoom(e)},maxZoom(e){const{map:n}=this;n.setMaxZoom(e)},highResolution(){this.reset()},mapClick(){this.reset()},mapType(e){const{map:n}=this;n.setMapType(window[e])},dragging(e){const{map:n}=this;e?n.enableDragging():n.disableDragging()},scrollWheelZoom(e){const{map:n}=this;e?n.enableScrollWheelZoom():n.disableScrollWheelZoom()},doubleClickZoom(e){const{map:n}=this;e?n.enableDoubleClickZoom():n.disableDoubleClickZoom()},keyboard(e){const{map:n}=this;e?n.enableKeyboard():n.disableKeyboard()},inertialDragging(e){const{map:n}=this;e?n.enableInertialDragging():n.disableInertialDragging()},continuousZoom(e){const{map:n}=this;e?n.enableContinuousZoom():n.disableContinuousZoom()},pinchToZoom(e){const{map:n}=this;e?n.enablePinchToZoom():n.disablePinchToZoom()},autoResize(e){const{map:n}=this;e?n.enableAutoResize():n.disableAutoResize()},theme(e){const{map:n}=this;n[K("setMapStyle")]({styleJson:e})},mapStyle:{handler(e){const{map:n,theme:p}=this;!p&&n[K("setMapStyle")](e)},deep:!0}},methods:{setMapOptions(){const{map:e,minZoom:n,maxZoom:p,mapType:l,dragging:u,scrollWheelZoom:i,doubleClickZoom:t,keyboard:o,inertialDragging:s,continuousZoom:h,pinchToZoom:g,autoResize:a}=this;n&&e.setMinZoom(n),p&&e.setMaxZoom(p),l&&e.setMapType(window[l]),u?e.enableDragging():e.disableDragging(),i?e.enableScrollWheelZoom():e.disableScrollWheelZoom(),t?e.enableDoubleClickZoom():e.disableDoubleClickZoom(),o?e.enableKeyboard():e.disableKeyboard(),s?e.enableInertialDragging():e.disableInertialDragging(),h?e.enableContinuousZoom():e.disableContinuousZoom(),g?e.enablePinchToZoom():e.disablePinchToZoom(),a?e.enableAutoResize():e.disableAutoResize()},init(e){if(this.map)return;let n=this.$refs.view;const p=new e.Map(n,{enableHighResolution:this.highResolution,enableMapClick:this.mapClick,preserveDrawingBuffer:this.preserveDrawingBuffer}),l=Math.random().toString();this.mapKey=l,this.map=p;const{setMapOptions:u,zoom:i,getCenterPoint:t,theme:o,mapStyle:s}=this;u(),V.call(this,p),p.reset(),this.setCenterZoom(p,t(),i),o?p[K("setMapStyle")]({styleJson:o}):s&&p[K("setMapStyle")](s);let h=0;this.$emit("init",{BMap:e,map:p,mapKey:l}),tt("init",{BMap:e,map:p,mapKey:l}),p.addEventListener("tilesloaded",()=>{h||(h++,this.$emit("ready",{BMap:e,map:p,mapKey:l}),tt("ready",{BMap:e,map:p,mapKey:l}))}),p.addEventListener("loaded",()=>{this.$emit("loaded",{BMap:e,map:p,mapKey:l}),tt("loaded",{BMap:e,map:p,mapKey:l})})},setCenterZoom(e,n,p){z().type==="WebGL"?this.hasAnimation&&this.defaultAnimation?e.centerAndZoom(n,p):e.setCenter(n,{noAnimation:!this.hasAnimation,callback:()=>{e.setZoom(p,{noAnimation:!this.hasAnimation,zoomCenter:n,callback:()=>{this.$emit("animationed",{BMap:this.BMap,map:e})}})}}):e.centerAndZoom(n,p)},getCenterPoint(){const{center:e,BMap:n}=this;switch(it(e)){case"String":return e;case"Object":return new n.Point(e.lng,e.lat);default:return new n.Point}},initMap(e){this.BMap=e,this.init(e),at(e)},getMapScript:()=>window.BMap?window.BMap._preloader?window.BMap._preloader:Promise.resolve(window.BMap):(window.BMap={},window.BMap._preloader=new Promise((e,n)=>{window._initBaiduMap=function(){window.BMap=z().type=="WebGL"?window.BMapGL:window.BMap,e(window.BMap),window.document.body.removeChild(p),window.BMap._preloader=null,window._initBaiduMap=null};const p=document.createElement("script");window.document.body.appendChild(p),z().type==="WebGL"?p.src=`https://api.map.baidu.com/api?v=1.0&type=webgl&ak=${z().ak}&callback=_initBaiduMap`:p.src=`https://api.map.baidu.com/api?v=${z().v}&ak=${z().ak}&callback=_initBaiduMap`}),window.BMap._preloader),reset(){const{getMapScript:e,initMap:n}=this;e().then(n)}},created(){const e={};this.ak&&(e.ak=this.ak),this.v&&(e.v=this.v),this.type&&(e.type=this.type),((n={})=>{H=Object.assign(H,n),H.ak})(e)},mounted(){this.reset()},data:()=>({hasBmView:!1,map:null,BMap:null,name:"bm-map",mapKey:""})},Mt={key:0,ref:"view",style:{width:"100%",height:"100%"}};var kt=j(xt,[["render",function(e,n,p,l,u,i){return L(),Z("div",{class:ct(e.$attrs.class),style:dt(e.$attrs.style)},[u.hasBmView?ht("",!0):(L(),Z("div",Mt,null,512)),$(e.$slots,"default")],6)}]]);const Ct={control:{unload:"removeControl"},layer:{unload:"removeTileLayer"},overlay:{unload:"removeOverlay"},contextMenu:{unload:"removeContextMenu"}},F=e=>e.abstract||e.name!=="bm-map"?F(e.$parent):e;function Bt(){const{unload:e,renderByParent:n,$parent:p,ready:l}=this;wt("ready",l),n&&p.reload(),e()}const St=(e={})=>({emits:["ready","init"],computed:{renderByParent(){return this.$parent.preventChildrenRender}},created(){const n=F(this.$parent),p=n.map,{ready:l,_init:u}=this;p?l():q("ready",({mapKey:i})=>this.emitCallBack(i,l)),p?this.init({BMap:n.BMap,map:p}):q("init",({mapKey:i})=>this.emitCallBack(i,u))},mounted(){const n=F(this.$parent).map,{mountedReady:p}=this;n?p():q("ready",({mapKey:l})=>this.emitCallBack(l,p))},unmounted:Bt,methods:{emitCallBack(n,p){n==F(this.$parent).mapKey&&p()},_init(){const n=F(this.$parent),p=this.BMap=n.BMap,l=this.map=n.map;this.init({BMap:p,map:l})},init(){},ready(){const n=F(this.$parent),p=this.BMap=n.BMap,l=this.map=n.map;this.load(),this.$emit("ready",{BMap:p,map:l})},mountedReady(){this.mountedLoad()},transmitEvent(n){this.$emit(n.type.replace(/^on/,""),n)},reload(){this&&this.BMap&&this.$nextTick(()=>{this.unload(),this.$nextTick(()=>{this.load(),this.mountedLoad()})})},unload(){const{map:n,originInstance:p}=this;try{switch(e.type){case"search":return p.clearResults();case"autoComplete":case"lushu":return p.dispose();case"markerClusterer":return p.clearMarkers();default:n[Ct[e.type].unload](p)}}catch{}},mountedLoad(){}}});var W=e=>St({type:e});const Pt={name:"bm-geolocation",render(){},mixins:[W("control")],props:{anchor:{type:String},offset:{type:Object},showAddressBar:{type:Boolean},autoLocation:{type:Boolean},locationIcon:{type:Object}},watch:{anchor(){this.reload()},offset(){this.reload()},showAddressBar(){this.reload()},autoLocation(){this.reload()},locationIcon(){this.reload()}},methods:{load(){const{BMap:e,map:n,anchor:p,showAddressBar:l,autoLocation:u,locationIcon:i,offset:t}=this;let o={anchor:window[p],showAddressBar:l,enableAutoLocation:u,offset:t&&A(e,t),locationIcon:i&&X(e,i)};G(o),z().type==="WebGL"?this.originInstance=new e.LocationControl(o):this.originInstance=new e.GeolocationControl(o),V.call(this,this.originInstance),n.addControl(this.originInstance)}}};var It=j({name:"bm-control",mixins:[W("control")],props:["anchor","offset"],watch:{anchor(e){this.originInstance.setAnchor(e)},offset(e){this.originInstance.setOffset(e)}},methods:{load(){const{BMap:e,map:n,anchor:p,offset:l,$el:u}=this,i=function(){this.defaultAnchor=window[p||"BMAP_ANCHOR_TOP_LEFT"],this.defaultOffset=A(e,l)};(i.prototype=new e.Control).initialize=t=>t.getContainer().appendChild(u),this.originInstance=new i,n.addControl(this.originInstance)}}},[["render",function(e,n,p,l,u,i){return L(),Z("div",null,[$(e.$slots,"default")])}]]),Tt=j({name:"bm-marker",mixins:[W("overlay")],inject:{Cluster:{default:()=>({})}},props:{position:{},offset:{},icon:{},massClear:{type:Boolean,default:!0},dragging:{type:Boolean,default:!1},clicking:{type:Boolean,default:!0},raiseOnDrag:{type:Boolean,default:!1},draggingCursor:{type:String},rotation:{type:Number},shadow:{type:Object},title:{type:String},label:{type:Object},animation:{type:String},top:{type:Boolean,default:!1},zIndex:{type:Number,default:0}},watch:{"position.lng"(e,n){const{BMap:p,originInstance:l,position:u,renderByParent:i,$parent:t}=this;e!==n&&e>=-180&&e<=180&&l.setPosition(R(p,{lng:e,lat:u.lat})),i&&t.reload()},"position.lat"(e,n){const{BMap:p,originInstance:l,position:u,renderByParent:i,$parent:t}=this;e!==n&&e>=-74&&e<=74&&l.setPosition(R(p,{lng:u.lng,lat:e})),i&&t.reload()},"offset.width"(e,n){const{BMap:p,originInstance:l}=this;e!==n&&l.setOffset(new p.Size(e,this.offset.height))},"offset.height"(e,n){const{BMap:p,originInstance:l}=this;e!==n&&l.setOffset(new p.Size(this.offset.width,e))},icon:{deep:!0,handler(e){const{BMap:n,originInstance:p,rotation:l}=this;p&&p.setIcon(X(n,e)),l&&p&&p.setRotation(l)}},massClear(e){e?this.originInstance.enableMassClear():this.originInstance.disableMassClear()},dragging(e){e?this.originInstance.enableDragging():this.originInstance.disableDragging()},clicking(){this.reload()},raiseOnDrag(){this.reload()},draggingCursor(e){this.originInstance.setDraggingCursor(e)},rotation(e){this.originInstance.setRotation(e)},shadow(e){this.originInstance.setShadow(e)},title(e){this.originInstance.setTitle(e)},label(e){this.reload()},animation(e){this.originInstance.setAnimation(window[e])},top(e){this.originInstance.setTop(e)},zIndex(e){this.originInstance.setZIndex(e)}},methods:{load(){var e,n;const{BMap:p,map:l,position:u,offset:i,icon:t,massClear:o,dragging:s,clicking:h,raiseOnDrag:g,draggingCursor:a,rotation:d,shadow:f,title:y,label:x,animation:c,top:w,renderByParent:C,$parent:P,zIndex:M}=this;let r={offset:i,icon:t&&X(p,t),enableMassClear:o,enableDragging:s,enableClicking:h,raiseOnDrag:g,draggingCursor:a,rotation:d,shadow:f,title:y};G(r);const m=new p.Marker(new p.Point(u.lng,u.lat),r);this.originInstance=m,x&&m&&m.setLabel(function(v,b={}){const{content:_,opts:B}=b;let k={offset:B.offset&&A(v,B.offset),position:B.position&&R(v,B.position),enableMassClear:B.enableMassClear};return G(k),new v.Label(_,k)}(p,x)),m.setTop(w),m.setZIndex(M),V.call(this,m),C?P.reload():l.addOverlay(m),m.setAnimation(window[c]),(n=(e=this.Cluster)==null?void 0:e.addMaker)==null||n.call(e,this)}},beforeUnmount(){var e,n;(n=(e=this.Cluster)==null?void 0:e.removeMaker)==null||n.call(e,this)}},[["render",function(e,n,p,l,u,i){return L(),Z("div",null,[$(e.$slots,"default")])}]]),Ot=j({name:"bm-local-search",emits:["markersset","infohtmlset","resultshtmlset","searchcomplete"],mixins:[W("search")],props:{location:{type:[Object,String]},keyword:{type:[Array,String]},panel:{type:Boolean,default:!0},forceLocal:{type:Boolean},customData:{type:Object},bounds:{type:Object},nearby:{type:Object},pageCapacity:{type:Number},autoViewport:{type:Boolean},selectFirstResult:{type:Boolean}},watch:{location:{handler(e){const{originInstance:n,search:p}=this;n.setLocation(e||this.map),p()},deep:!0},keyword(){this.search()},bounds:{handler(e){const{searchInBounds:n}=this;n(e)},deep:!0},nearby:{handler(e){const{searchNearby:n}=this;n(e)},deep:!0},forceLocal(){this.reload()},customData:{deep:!0,handler(){this.reload()}},pageCapacity(e){this.originInstance&&this.originInstance.setPageCapacity(e)},autoViewport(e){this.originInstance&&(e?this.originInstance.enableAutoViewport():this.originInstance.disableAutoViewport())},selectFirstResult(e){this.originInstance&&(e?this.originInstance.enableFirstResultSelection():this.originInstance.disableFirstResultSelection())},highlightMode(){this.reload()}},methods:{searchNearby(e){const{originInstance:n,keyword:p,customData:l,BMap:u}=this;n.searchNearby(p,R(u,e.center),e.radius,l)},searchInBounds(e){const{originInstance:n,keyword:p,customData:l,BMap:u}=this;n.searchInBounds(p,function(i,t={}){const{sw:o,ne:s}=t;return new i.Bounds(R(i,o),R(i,s))}(u,e),l)},search(){const{originInstance:e,keyword:n,forceLocal:p,customData:l,nearby:u,bounds:i,searchNearby:t,searchInBounds:o}=this;u?t(u):i?o(i):e.search(n,{forceLocal:p,customData:l})},load(){const e=this,{map:n,BMap:p,search:l,pageCapacity:u,autoViewport:i,selectFirstResult:t,highlightMode:o,location:s,originInstance:h}=this,g=s?(a=s).lng&&a.lat?R(p,s):s:n;var a;const d=this.originInstance=new p.LocalSearch(g,{onMarkersSet(f){e.$emit("markersset",f)},onInfoHtmlSet(f){e.$emit("infohtmlset",f)},onResultsHtmlSet(f){e.$emit("resultshtmlset",f)},onSearchComplete(f){h&&h!==d&&h.clearResults(),e.$emit("searchcomplete",f)},pageCapacity:u,renderOptions:{map:n,panel:this.$el,selectFirstResult:t,autoViewport:i,highlightMode:o}});l()}}},[["render",function(e,n,p,l,u,i){return lt((L(),Z("div",null,[$(e.$slots,"default")],512)),[[pt,p.panel]])}]]);const Et={name:"bm-autocomplete",mixins:[W("autoComplete")],emits:["update:modelValue","searchcomplete"],props:{types:{type:String},location:{type:String},sugStyle:{type:Object,default:()=>({})},modelValue:{}},watch:{types(){this.reload()},location(){this.reload()}},methods:{load(){const{BMap:e,map:n,$el:p,types:l,location:u,sugStyle:i}=this,t=p.querySelector("input");t&&(this.originInstance=new e.Autocomplete({input:t,types:l,location:u||n,onSearchComplete:o=>{const s=document.querySelectorAll(".tangram-suggestion-main");for(const h of s)for(const g in i)h.style[g]=i[g].toString();this.$emit("searchcomplete",o)}}),this.originInstance.addEventListener("onconfirm",o=>{const s=o.item.value;this.$emit("update:modelValue",s.province+s.city+s.district+s.street+s.business)}),V.call(this,this.originInstance))}}},At=rt("input",null,null,-1);var zt=j(Et,[["render",function(e,n,p,l,u,i){return L(),Z("span",null,[$(e.$slots,"default",{},()=>[At])])}]]);(function(){var e=typeof window<"u"?window:ot!==void 0?ot:this;function n(a,d){return a(d={exports:{}},d.exports,e),d.exports}var p=n(function(a,d,f){(function(y,x){typeof d=="object"?a.exports=x():(y.BMapLib=y.BMapLib||{},y.BMapLib.TextIconOverlay=y.BMapLib.TextIconOverlay||x())})(e,function(){var y,x,c=y=c||{version:"1.3.8"},w={};c.guid="$BAIDU$",w[c.guid]=w[c.guid]||{},c.dom=c.dom||{},c.dom.g=function(r){return typeof r=="string"||r instanceof String?document.getElementById(r):r&&r.nodeName&&(r.nodeType==1||r.nodeType==9)?r:null},c.g=c.G=c.dom.g,c.dom.getDocument=function(r){return(r=c.dom.g(r)).nodeType==9?r:r.ownerDocument||r.document},c.lang=c.lang||{},c.lang.isString=function(r){return Object.prototype.toString.call(r)=="[object String]"},c.isString=c.lang.isString,c.dom._g=function(r){return c.lang.isString(r)?document.getElementById(r):r},c._g=c.dom._g,c.browser=c.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(c.browser.ie=c.ie=document.documentMode||+RegExp.$1),c.dom.getComputedStyle=function(r,m){r=c.dom._g(r);var v,b=c.dom.getDocument(r);return b.defaultView&&b.defaultView.getComputedStyle&&(v=b.defaultView.getComputedStyle(r,null))?v[m]||v.getPropertyValue(m):""},c.dom._styleFixer=c.dom._styleFixer||{},c.dom._styleFilter=c.dom._styleFilter||[],c.dom._styleFilter.filter=function(r,m,v){for(var b,_=0,B=c.dom._styleFilter;b=B[_];_++)(b=b[v])&&(m=b(r,m));return m},c.string=c.string||{},c.string.toCamelCase=function(r){return r.indexOf("-")<0&&r.indexOf("_")<0?r:r.replace(/[-_][^-_]/g,function(m){return m.charAt(1).toUpperCase()})},c.dom.getStyle=function(r,m){var v=c.dom;r=v.g(r),m=c.string.toCamelCase(m);var b=r.style[m]||(r.currentStyle?r.currentStyle[m]:"")||v.getComputedStyle(r,m);if(!b){var _=v._styleFixer[m];_&&(b=_.get?_.get(r):c.dom.getStyle(r,_))}return(_=v._styleFilter)&&(b=_.filter(m,b,"get")),b},c.getStyle=c.dom.getStyle,/opera\/(\d+\.\d)/i.test(navigator.userAgent)&&(c.browser.opera=+RegExp.$1),c.browser.isWebkit=/webkit/i.test(navigator.userAgent),c.browser.isGecko=/gecko/i.test(navigator.userAgent)&&!/like gecko/i.test(navigator.userAgent),c.browser.isStrict=document.compatMode=="CSS1Compat",c.dom.getPosition=function(r){r=c.dom.g(r);var m=c.dom.getDocument(r),v=c.browser,b=c.dom.getStyle;v.isGecko>0&&m.getBoxObjectFor&&b(r,"position")=="absolute"&&(r.style.top===""||r.style.left);var _,B,k={left:0,top:0};if(r==(v.ie&&!v.isStrict?m.body:m.documentElement))return k;if(r.getBoundingClientRect){B=r.getBoundingClientRect(),k.left=Math.floor(B.left)+Math.max(m.documentElement.scrollLeft,m.body.scrollLeft),k.top=Math.floor(B.top)+Math.max(m.documentElement.scrollTop,m.body.scrollTop),k.left-=m.documentElement.clientLeft,k.top-=m.documentElement.clientTop;var S=m.body,T=parseInt(b(S,"borderLeftWidth")),N=parseInt(b(S,"borderTopWidth"));v.ie&&!v.isStrict&&(k.left-=isNaN(T)?2:T,k.top-=isNaN(N)?2:N)}else{_=r;do{if(k.left+=_.offsetLeft,k.top+=_.offsetTop,v.isWebkit>0&&b(_,"position")=="fixed"){k.left+=m.body.scrollLeft,k.top+=m.body.scrollTop;break}_=_.offsetParent}while(_&&_!=r);for((v.opera>0||v.isWebkit>0&&b(r,"position")=="absolute")&&(k.top-=m.body.offsetTop),_=r.offsetParent;_&&_!=m.body;)k.left-=_.scrollLeft,v.opera&&_.tagName=="TR"||(k.top-=_.scrollTop),_=_.offsetParent}return k},c.event=c.event||{},c.event._listeners=c.event._listeners||[],c.event.on=function(r,m,v){m=m.replace(/^on/i,""),r=c.dom._g(r);var b,_=function(T){v.call(r,T)},B=c.event._listeners,k=c.event._eventFilter,S=m;return m=m.toLowerCase(),k&&k[m]&&(S=(b=k[m](r,m,_)).type,_=b.listener),r.addEventListener?r.addEventListener(S,_,!1):r.attachEvent&&r.attachEvent("on"+S,_),B[B.length]=[r,m,v,_,S],r},c.on=c.event.on,x=w[c.guid],c.lang.guid=function(){return"TANGRAM__"+(x._counter++).toString(36)},x._counter=x._counter||1,w[c.guid]._instances=w[c.guid]._instances||{},c.lang.isFunction=function(r){return Object.prototype.toString.call(r)=="[object Function]"},c.lang.Class=function(r){this.guid=r||c.lang.guid(),w[c.guid]._instances[this.guid]=this},w[c.guid]._instances=w[c.guid]._instances||{},c.lang.Class.prototype.dispose=function(){for(var r in delete w[c.guid]._instances[this.guid],this)c.lang.isFunction(this[r])||delete this[r];this.disposed=!0},c.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},c.lang.Event=function(r,m){this.type=r,this.returnValue=!0,this.target=m||null,this.currentTarget=null},c.lang.Class.prototype.addEventListener=function(r,m,v){if(c.lang.isFunction(m)){!this.__listeners&&(this.__listeners={});var b,_=this.__listeners;if(typeof v=="string"&&v){if(/[^\w\-]/.test(v))throw"nonstandard key:"+v;m.hashCode=v,b=v}r.indexOf("on")!=0&&(r="on"+r),typeof _[r]!="object"&&(_[r]={}),b=b||c.lang.guid(),m.hashCode=b,_[r][b]=m}},c.lang.Class.prototype.removeEventListener=function(r,m){if(m===void 0||(!c.lang.isFunction(m)||(m=m.hashCode))&&c.lang.isString(m)){!this.__listeners&&(this.__listeners={}),r.indexOf("on")!=0&&(r="on"+r);var v=this.__listeners;if(v[r])if(m!==void 0)v[r][m]&&delete v[r][m];else for(var b in v[r])delete v[r][b]}},c.lang.Class.prototype.dispatchEvent=function(r,m){for(var v in c.lang.isString(r)&&(r=new c.lang.Event(r)),!this.__listeners&&(this.__listeners={}),m=m||{})r[v]=m[v];var b=this.__listeners,_=r.type;if(r.target=r.target||this,r.currentTarget=this,_.indexOf("on")!=0&&(_="on"+_),c.lang.isFunction(this[_])&&this[_].apply(this,arguments),typeof b[_]=="object")for(v in b[_])b[_][v].apply(this,arguments);return r.returnValue},c.lang.inherits=function(r,m,v){var b,_,B=r.prototype,k=new Function;for(b in k.prototype=m.prototype,_=r.prototype=new k,B)_[b]=B[b];r.prototype.constructor=r,r.superClass=m.prototype,typeof v=="string"&&(_._className=v)},c.inherits=c.lang.inherits;var C="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/images/m",P="png",M=function(r,m,v){try{BMap}catch{throw Error("Baidu Map JS API is not ready yet!")}y.lang.inherits(M,BMap.Overlay,"TextIconOverlay"),this._position=r,this._text=m,this._options=v||{},this._styles=this._options.styles||[],!this._styles.length&&this._setupDefaultStyles()};return M.prototype._setupDefaultStyles=function(){for(var r,m=[53,56,66,78,90],v=0;r=m[v];v++)this._styles.push({url:C+v+"."+P,size:new BMap.Size(r,r)})},M.prototype.initialize=function(r){return this._map=r,this._domElement=document.createElement("div"),this._updateCss(),this._updateText(),this._updatePosition(),this._bind(),this._map.getPanes().markerMouseTarget.appendChild(this._domElement),this._domElement},M.prototype.draw=function(){this._map&&this._updatePosition()},M.prototype.getText=function(){return this._text},M.prototype.setText=function(r){!r||this._text&&this._text.toString()==r.toString()||(this._text=r,this._updateText(),this._updateCss(),this._updatePosition())},M.prototype.getPosition=function(){return this._position},M.prototype.setPosition=function(r){!r||this._position&&this._position.equals(r)||(this._position=r,this._updatePosition())},M.prototype.getStyleByText=function(r,m){var v=parseInt(r),b=parseInt(v/10);return b=Math.max(0,b),m[b=Math.min(b,m.length-1)]},M.prototype._updateCss=function(){if(this._domElement){var r=this.getStyleByText(this._text,this._styles);this._domElement.style.cssText=this._buildCssText(r)}},M.prototype._updateText=function(){this._domElement&&(this._domElement.innerHTML=this._text)},M.prototype._updatePosition=function(){if(this._domElement&&this._position){var r=this._domElement.style,m=this._map.pointToOverlayPixel(this._position);m.x-=Math.ceil(parseInt(r.width)/2),m.y-=Math.ceil(parseInt(r.height)/2),r.left=m.x+"px",r.top=m.y+"px"}},M.prototype._buildCssText=function(r){var m=r.url,v=r.size,b=r.anchor,_=r.offset,B=r.textColor||"black",k=r.textSize||10,S=[];if(y.browser.ie<7)S.push('filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+m+'");');else{S.push("background-image:url("+m+");");var T="0 0";_ instanceof BMap.Size&&(T=_.width+"px "+_.height+"px"),S.push("background-position:"+T+";")}return v instanceof BMap.Size&&(b instanceof BMap.Size?(b.height>0&&b.height<v.height&&S.push("height:"+(v.height-b.height)+"px; padding-top:"+b.height+"px;"),b.width>0&&b.width<v.width&&S.push("width:"+(v.width-b.width)+"px; padding-left:"+b.width+"px;")):(S.push("height:"+v.height+"px; line-height:"+v.height+"px;"),S.push("width:"+v.width+"px; text-align:center;"))),S.push("cursor:pointer; color:"+B+"; position:absolute; font-size:"+k+"px; font-family:Arial,sans-serif; font-weight:bold"),S.join("")},M.prototype._bind=function(){if(this._domElement){var r=this,m=this._map,v=y.lang.Event;y.event.on(this._domElement,"mouseover",function(_){r.dispatchEvent(b(_,new v("onmouseover")))}),y.event.on(this._domElement,"mouseout",function(_){r.dispatchEvent(b(_,new v("onmouseout")))}),y.event.on(this._domElement,"click",function(_){r.dispatchEvent(b(_,new v("onclick")))})}function b(_,B){var k=_.srcElement||_.target,S=_.clientX||_.pageX,T=_.clientY||_.pageY;if(_&&B&&S&&T&&k){var N=y.dom.getPosition(m.getContainer());B.pixel=new BMap.Pixel(S-N.left,T-N.top),B.point=m.pixelToPoint(B.pixel)}return B}},M})}),l=p&&typeof p=="object"&&"default"in p?p.default:p,u=function(a,d,f){d=i(d);var y=a.pointToPixel(d.getNorthEast()),x=a.pointToPixel(d.getSouthWest());y.x+=f,y.y-=f,x.x-=f,x.y+=f;var c=a.pixelToPoint(y),w=a.pixelToPoint(x);return new BMap.Bounds(w,c)},i=function(a){var d=t(a.getNorthEast().lng,-180,180),f=t(a.getSouthWest().lng,-180,180),y=t(a.getNorthEast().lat,-74,74),x=t(a.getSouthWest().lat,-74,74);return new BMap.Bounds(new BMap.Point(f,x),new BMap.Point(d,y))},t=function(a,d,f){return d&&(a=Math.max(a,d)),f&&(a=Math.min(a,f)),a},o=function(a){return Object.prototype.toString.call(a)==="[object Array]"},s=function(a,d){var f=-1;if(o(d)){if(d.indexOf)f=d.indexOf(a);else for(var y,x=0;y=d[x];x++)if(y===a){f=x;break}}return f},h=function(a,d){try{BMap}catch{throw Error("Baidu Map JS API is not ready yet!")}if(a){this._map=a,this._markers=[],this._clusters=[];var f=d||{};this._gridSize=f.gridSize||60,this._maxZoom=f.maxZoom||18,this._minClusterSize=f.minClusterSize||2,this._isAverageCenter=!1,f.isAverageCenter!=null&&(this._isAverageCenter=f.isAverageCenter),this._styles=f.styles||[];var y=this;this._map.addEventListener("zoomend",function(){y._redraw()}),this._map.addEventListener("moveend",function(){y._redraw()});var x=f.markers;o(x)&&this.addMarkers(x)}};function g(a){this._markerClusterer=a,this._map=a.getMap(),this._minClusterSize=a.getMinClusterSize(),this._isAverageCenter=a.isAverageCenter(),this._center=null,this._markers=[],this._gridBounds=null,this._isReal=!1,this._clusterMarker=new l(this._center,this._markers.length,{styles:this._markerClusterer.getStyles()})}h.prototype.addMarkers=function(a){if(a.length){for(var d=0,f=a.length;d<f;d++)this._pushMarkerTo(a[d]);this._createClusters()}},h.prototype._pushMarkerTo=function(a){s(a,this._markers)===-1&&(a.isInCluster=!1,this._markers.push(a))},h.prototype.addMarker=function(a){this._pushMarkerTo(a),this._createClusters()},h.prototype._createClusters=function(){var a=this._map.getBounds();if(a.getCenter())for(var d,f=u(this._map,a,this._gridSize),y=0;d=this._markers[y];y++)!d.isInCluster&&f.containsPoint(d.getPosition())&&this._addToClosestCluster(d)},h.prototype._addToClosestCluster=function(a){var d=4e6,f=null;a.getPosition();for(var y,x=0;y=this._clusters[x];x++){var c=y.getCenter();if(c){var w=this._map.getDistance(c,a.getPosition());w<d&&(d=w,f=y)}}f&&f.isMarkerInClusterBounds(a)?f.addMarker(a):((y=new g(this)).addMarker(a),this._clusters.push(y))},h.prototype._clearLastClusters=function(){for(var a,d=0;a=this._clusters[d];d++)a.remove();this._clusters=[],this._removeMarkersFromCluster()},h.prototype._removeMarkersFromCluster=function(){for(var a,d=0;a=this._markers[d];d++)a.isInCluster=!1},h.prototype._removeMarkersFromMap=function(){for(var a,d=0;a=this._markers[d];d++){a.isInCluster=!1;var f=a.getLabel();this._map.removeOverlay(a),a.setLabel(f)}},h.prototype._removeMarker=function(a){var d=s(a,this._markers);return d!==-1&&(this._map.removeOverlay(a),this._markers.splice(d,1),!0)},h.prototype.removeMarker=function(a){var d=this._removeMarker(a);return d&&(this._clearLastClusters(),this._createClusters()),d},h.prototype.removeMarkers=function(a){for(var d=!1,f=0;f<a.length;f++){var y=this._removeMarker(a[f]);d=d||y}return d&&(this._clearLastClusters(),this._createClusters()),d},h.prototype.clearMarkers=function(){this._clearLastClusters(),this._removeMarkersFromMap(),this._markers=[]},h.prototype._redraw=function(){this._clearLastClusters(),this._createClusters()},h.prototype.getGridSize=function(){return this._gridSize},h.prototype.setGridSize=function(a){this._gridSize=a,this._redraw()},h.prototype.getMaxZoom=function(){return this._maxZoom},h.prototype.setMaxZoom=function(a){this._maxZoom=a,this._redraw()},h.prototype.getStyles=function(){return this._styles},h.prototype.setStyles=function(a){this._styles=a,this._redraw()},h.prototype.getMinClusterSize=function(){return this._minClusterSize},h.prototype.setMinClusterSize=function(a){this._minClusterSize=a,this._redraw()},h.prototype.isAverageCenter=function(){return this._isAverageCenter},h.prototype.getMap=function(){return this._map},h.prototype.getMarkers=function(){return this._markers},h.prototype.getClustersCount=function(){for(var a,d=0,f=0;a=this._clusters[f];f++)a.isReal()&&d++;return d},g.prototype.addMarker=function(a){if(this.isMarkerInCluster(a))return!1;if(this._center){if(this._isAverageCenter){var d=this._markers.length+1,f=(this._center.lat*(d-1)+a.getPosition().lat)/d,y=(this._center.lng*(d-1)+a.getPosition().lng)/d;this._center=new BMap.Point(y,f),this.updateGridBounds()}}else this._center=a.getPosition(),this.updateGridBounds();a.isInCluster=!0,this._markers.push(a);var x=this._markers.length;if(x<this._minClusterSize)return this._map.addOverlay(a),!0;if(x===this._minClusterSize)for(var c=0;c<x;c++){var w=this._markers[c].getLabel();this._markers[c].getMap()&&this._map.removeOverlay(this._markers[c]),this._markers[c].setLabel(w)}return this._map.addOverlay(this._clusterMarker),this._isReal=!0,this.updateClusterMarker(),!0},g.prototype.isMarkerInCluster=function(a){if(this._markers.indexOf)return this._markers.indexOf(a)!=-1;for(var d,f=0;d=this._markers[f];f++)if(d===a)return!0;return!1},g.prototype.isMarkerInClusterBounds=function(a){return this._gridBounds.containsPoint(a.getPosition())},g.prototype.isReal=function(a){return this._isReal},g.prototype.updateGridBounds=function(){var a=new BMap.Bounds(this._center,this._center);this._gridBounds=u(this._map,a,this._markerClusterer.getGridSize())},g.prototype.updateClusterMarker=function(){if(this._map.getZoom()>this._markerClusterer.getMaxZoom()){this._clusterMarker&&this._map.removeOverlay(this._clusterMarker);for(var a,d=0;a=this._markers[d];d++)this._map.addOverlay(a)}else this._markers.length<this._minClusterSize?this._clusterMarker.hide():(this._clusterMarker.setPosition(this._center),this._clusterMarker.setText(this._markers.length),this._clusterMarker.addEventListener&&!this._clusterMarker._hasClickEvent&&this._clusterMarker.addEventListener("click",(function(f){this._clusterMarker._hasClickEvent=!0,this._markers&&this._map.setViewport(this.getBounds())}).bind(this)))},g.prototype.remove=function(){for(var a=0;this._markers[a];a++){var d=this._markers[a].getLabel();this._markers[a].getMap()&&this._map.removeOverlay(this._markers[a]),this._markers[a].setLabel(d)}this._map.removeOverlay(this._clusterMarker),this._markers.length=0,delete this._markers},g.prototype.getBounds=function(){for(var a,d=new BMap.Bounds(this._center,this._center),f=0;a=this._markers[f];f++)d.extend(a.getPosition());return d},g.prototype.getCenter=function(){return this._center}})(),function(){var e,n={dom:{}};n.dom.g=function(i){return typeof i=="string"||i instanceof String?document.getElementById(i):i&&i.nodeName&&(i.nodeType==1||i.nodeType==9)?i:null},n.g=n.G=n.dom.g,n.lang=n.lang||{},n.lang.isString=function(i){return Object.prototype.toString.call(i)=="[object String]"},n.isString=n.lang.isString,n.dom._g=function(i){return n.lang.isString(i)?document.getElementById(i):i},n._g=n.dom._g,n.dom.getDocument=function(i){return(i=n.dom.g(i)).nodeType==9?i:i.ownerDocument||i.document},n.browser=n.browser||{},n.browser.ie=n.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,n.dom.getComputedStyle=function(i,t){i=n.dom._g(i);var o,s=n.dom.getDocument(i);return s.defaultView&&s.defaultView.getComputedStyle&&(o=s.defaultView.getComputedStyle(i,null))?o[t]||o.getPropertyValue(t):""},n.dom._styleFixer=n.dom._styleFixer||{},n.dom._styleFilter=n.dom._styleFilter||[],n.dom._styleFilter.filter=function(i,t,o){for(var s,h=0,g=n.dom._styleFilter;s=g[h];h++)(s=s[o])&&(t=s(i,t));return t},n.string=n.string||{},n.string.toCamelCase=function(i){return i.indexOf("-")<0&&i.indexOf("_")<0?i:i.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},n.dom.getStyle=function(i,t){var o=n.dom;i=o.g(i),t=n.string.toCamelCase(t);var s=i.style[t]||(i.currentStyle?i.currentStyle[t]:"")||o.getComputedStyle(i,t);if(!s){var h=o._styleFixer[t];h&&(s=h.get?h.get(i):n.dom.getStyle(i,h))}return(h=o._styleFilter)&&(s=h.filter(t,s,"get")),s},n.getStyle=n.dom.getStyle,n.dom._NAME_ATTRS=(e={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"},n.browser.ie<8?(e.for="htmlFor",e.class="className"):(e.htmlFor="for",e.className="class"),e),n.dom.setAttr=function(i,t,o){return i=n.dom.g(i),t=="style"?i.style.cssText=o:(t=n.dom._NAME_ATTRS[t]||t,i.setAttribute(t,o)),i},n.setAttr=n.dom.setAttr,n.dom.setAttrs=function(i,t){for(var o in i=n.dom.g(i),t)n.dom.setAttr(i,o,t[o]);return i},n.setAttrs=n.dom.setAttrs,n.dom.create=function(i,t){var o=document.createElement(i),s=t||{};return n.dom.setAttrs(o,s)},n.object=n.object||{},n.extend=n.object.extend=function(i,t){for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);return i};var p=function(i,t,o){try{BMap}catch{throw Error("Baidu Map JS API is not ready yet!")}!t||t.length<1||(this._map=i,this._path=t,this.i=0,this._setTimeoutQuene=[],this._projection=this._map.getMapType().getProjection(),this._opts={icon:null,speed:4e3,defaultContent:"",showInfoWindow:!1},this._setOptions(o),this._rotation=0,!this._opts.icon instanceof BMap.Icon&&(this._opts.icon=defaultIcon))};function l(i,t){this._point=i,this._html=t}function u(){l.prototype=new BMap.Overlay,l.prototype.initialize=function(i){var t=this._div=n.dom.create("div",{style:"border:solid 1px #ccc;width:auto;min-width:50px;text-align:center;position:absolute;background:#fff;color:#000;font-size:12px;border-radius: 10px;padding:5px;white-space: nowrap;"});return t.innerHTML=this._html,i.getPanes().floatPane.appendChild(t),this._map=i,t},l.prototype.draw=function(){this.setPosition(this.lushuMain._marker.getPosition(),this.lushuMain._marker.getIcon().size)},n.object.extend(l.prototype,{setPosition:function(i,t){var o=this._map.pointToOverlayPixel(i),s=n.dom.getStyle(this._div,"width"),h=n.dom.getStyle(this._div,"height"),g=parseInt(this._div.clientWidth||s,10);parseInt(this._div.clientHeight||h,10),this._div.style.left=o.x-g/2+"px",this._div.style.bottom=-(o.y-t.height)+"px"},setHtml:function(i){this._div.innerHTML=i},setRelatedClass:function(i){this.lushuMain=i}})}p.prototype._setOptions=function(i){if(i)for(var t in i)i.hasOwnProperty(t)&&(this._opts[t]=i[t])},p.prototype.start=function(){var i=this,t=i._path.length;if(this._opts.onstart&&this._opts.onstart(i),i.i&&i.i<t-1){if(!i._fromPause)return;i._fromStop||i._moveNext(++i.i)}else!i._marker&&i._addMarker(),i._timeoutFlag=setTimeout(function(){!i._overlay&&i._addInfoWin(),i._moveNext(i.i)},400);this._fromPause=!1,this._fromStop=!1},p.prototype.stop=function(){this.i=0,this._fromStop=!0,clearInterval(this._intervalFlag),this._clearTimeout();for(var i=0,t=this._opts.landmarkPois,o=t.length;i<o;i++)t[i].bShow=!1;this._opts.onstop&&this._opts.onstop(this)},p.prototype.pause=function(){clearInterval(this._intervalFlag),this._fromPause=!0,this._clearTimeout(),this._opts.onpause&&this._opts.onpause(this)},p.prototype.hideInfoWindow=function(){this._opts.showInfoWindow=!1,this._overlay&&(this._overlay._div.style.visibility="hidden")},p.prototype.showInfoWindow=function(){this._opts.showInfoWindow=!0,this._overlay&&(this._overlay._div.style.visibility="visible")},p.prototype.dispose=function(){clearInterval(this._intervalFlag),this._setTimeoutQuene&&this._clearTimeout(),this._map&&(this._map.removeOverlay(this._overlay),this._map.removeOverlay(this._marker))},n.object.extend(p.prototype,{_addMarker:function(i){this._marker&&(this.stop(),this._map.removeOverlay(this._marker),clearTimeout(this._timeoutFlag)),this._overlay&&this._map.removeOverlay(this._overlay);var t=new BMap.Marker(this._path[0]);this._opts.icon&&t.setIcon(this._opts.icon),this._map.addOverlay(t),t.setAnimation(BMAP_ANIMATION_DROP),this._marker=t},_addInfoWin:function(){var i=this;!l.prototype.initialize&&u();var t=new l(i._marker.getPosition(),i._opts.defaultContent);t.setRelatedClass(this),this._overlay=t,this._map.addOverlay(t),this._opts.showInfoWindow?this.showInfoWindow():this.hideInfoWindow()},_getMercator:function(i){return this._map.getMapType().getProjection().lngLatToPoint(i)},_getDistance:function(i,t){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},_move:function(i,t,o){var s=this,h=0,g=10,a=this._opts.speed/(1e3/g),d=this._projection.lngLatToPoint(i),f=this._projection.lngLatToPoint(t),y=Math.round(s._getDistance(d,f)/a);y<1?s._moveNext(++s.i):s._intervalFlag=setInterval(function(){if(h>=y){if(clearInterval(s._intervalFlag),s.i>s._path.length)return;s._moveNext(++s.i),s._opts.onmove(s)}else{h++;var x=o(d.x,f.x,h,y),c=o(d.y,f.y,h,y),w=s._projection.pointToLngLat(new BMap.Pixel(x,c));if(h==1){var C=null;s.i-1>=0&&(C=s._path[s.i-1]),s._opts.enableRotation==1&&s.setRotation(C,i,t),s._opts.autoView&&(s._map.getBounds().containsPoint(w)||s._map.setCenter(w))}s._marker.setPosition(w),s._setInfoWin(w)}},g)},setRotation:function(i,t,o){var s=this,h=0;if(t=s._map.pointToPixel(t),(o=s._map.pointToPixel(o)).x!=t.x){var g=(o.y-t.y)/(o.x-t.x);h=360*Math.atan(g)/(2*Math.PI),h=o.x<t.x?90-h+90:-h,s._marker.setRotation(-h)}else{var a=0;a=o.y-t.y>0?-1:1,s._marker.setRotation(90*-a)}},linePixellength:function(i,t){return Math.sqrt(Math.abs(i.x-t.x)*Math.abs(i.x-t.x)+Math.abs(i.y-t.y)*Math.abs(i.y-t.y))},pointToPoint:function(i,t){return Math.abs(i.x-t.x)*Math.abs(i.x-t.x)+Math.abs(i.y-t.y)*Math.abs(i.y-t.y)},_moveNext:function(i){var t=this;i<this._path.length-1?t._move(t._path[i],t._path[i+1],t._tween.linear):t.stop()},moveNext:function(i){var t=this;i<this._path.length-1?t._move(t._path[i],t._path[i+1],t._tween.linear):t.stop()},_setInfoWin:function(i){var t=this;t._overlay.setPosition(i,t._marker.getIcon().size);var o=t._troughPointIndex(i);o!=-1?(clearInterval(t._intervalFlag),t._overlay.setHtml(t._opts.landmarkPois[o].html),t._overlay.setPosition(i,t._marker.getIcon().size),t._pauseForView(o)):t._overlay.setHtml(t._opts.defaultContent)},_pauseForView:function(i){var t=this,o=setTimeout(function(){t._moveNext(++t.i)},1e3*t._opts.landmarkPois[i].pauseTime);t._setTimeoutQuene.push(o)},_clearTimeout:function(){for(var i in this._setTimeoutQuene)clearTimeout(this._setTimeoutQuene[i]);this._setTimeoutQuene.length=0},_tween:{linear:function(i,t,o,s){return(t-i)*o/s+i}},_troughPointIndex:function(i){for(var t=this._opts.landmarkPois,o=0,s=t.length;o<s;o++)if(!t[o].bShow&&this._map.getDistance(new BMap.Point(t[o].lng,t[o].lat),i)<10)return t[o].bShow=!0,o;return-1}})}(),function(){function e(l,u,i){var t,o,s=l.prototype,h=new Function;for(t in h.prototype=u.prototype,o=l.prototype=new h,s)o[t]=s[t];l.prototype.constructor=l,l.superClass=u.prototype,o._className=i}var n=function(){var l=function(t){var o={data:[],heatmap:t};this.max=1,this.get=function(s){return o[s]},this.set=function(s,h){o[s]=h}};l.prototype={addDataPoint:function(t,o){if(!(t<0||o<0)){var s=this,h=s.get("heatmap"),g=s.get("data");if(g[t]||(g[t]=[]),g[t][o]||(g[t][o]=0),g[t][o]+=arguments.length<3?1:arguments[2],s.set("data",g),s.max<g[t][o])return h.get("actx").clearRect(0,0,h.get("width"),h.get("height")),void s.setDataSet({max:g[t][o],data:g},!0);h.drawAlpha(t,o,g[t][o],!0)}},setDataSet:function(t,o){var s=this.get("heatmap"),h=[],g=t.data,a=g.length;if(s.clear(),this.max=t.max,s.get("legend")&&s.get("legend").update(t.max),o!=null&&o){for(var d in g)if(d!==void 0)for(var f in g[d])f!==void 0&&s.drawAlpha(d,f,g[d][f],!1)}else for(;a--;){var y=g[a];s.drawAlpha(y.x,y.y,y.count,!1),h[y.x]||(h[y.x]=[]),h[y.x][y.y]||(h[y.x][y.y]=0),h[y.x][y.y]=y.count}s.colorize(),this.set("data",g)},exportDataSet:function(){var t=this,o=t.get("data"),s=[];for(var h in o)if(h!==void 0)for(var g in o[h])g!==void 0&&s.push({x:parseInt(h,10),y:parseInt(g,10),count:o[h][g]});return{max:t.max,data:s}},generateRandomDataSet:function(t){var o=this.get("heatmap"),s=o.get("width"),h=o.get("height"),g={},a=Math.floor(1e3*Math.random()+1);g.max=a;for(var d=[];t--;)d.push({x:Math.floor(Math.random()*s+1),y:Math.floor(Math.random()*h+1),count:Math.floor(Math.random()*a+1)});g.data=d,this.setDataSet(g)}};var u=function(t){this.config=t;var o={element:null,labelsEl:null,gradientCfg:null,ctx:null};this.get=function(s){return o[s]},this.set=function(s,h){o[s]=h},this.init()};u.prototype={init:function(){var t=this,o=t.config,s=o.title||"Legend",h=o.position,g=o.offset||10;o.gradient;var a,d,f=document.createElement("ul"),y="";t.processGradientObject(),h.indexOf("t")>-1?y+="top:"+g+"px;":y+="bottom:"+g+"px;",h.indexOf("l")>-1?y+="left:"+g+"px;":y+="right:"+g+"px;",(a=document.createElement("div")).style.cssText="border-radius:5px;position:absolute;"+y+"font-family:Helvetica; width:256px;z-index:10000000000; background:rgba(255,255,255,1);padding:10px;border:1px solid black;margin:0;",a.innerHTML="<h3 style='padding:0;margin:0;text-align:center;font-size:16px;'>"+s+"</h3>",f.style.cssText="position:relative;font-size:12px;display:block;list-style:none;list-style-type:none;margin:0;height:15px;",(d=document.createElement("div")).style.cssText=["position:relative;display:block;width:256px;height:15px;border-bottom:1px solid black; background-image:url(",t.createGradientImage(),");"].join(""),a.appendChild(f),a.appendChild(d),t.set("element",a),t.set("labelsEl",f),t.update(1)},processGradientObject:function(){var t=this,o=this.config.gradient,s=[];for(var h in o)o.hasOwnProperty(h)&&s.push({stop:h,value:o[h]});s.sort(function(g,a){return g.stop-a.stop}),s.unshift({stop:0,value:"rgba(0,0,0,0)"}),t.set("gradientArr",s)},createGradientImage:function(){var t,o=this,s=o.get("gradientArr"),h=s.length,g=document.createElement("canvas"),a=g.getContext("2d");g.width="256",g.height="15",t=a.createLinearGradient(0,5,256,10);for(var d=0;d<h;d++)t.addColorStop(1/(h-1)*d,s[d].value);for(a.fillStyle=t,a.fillRect(0,5,256,10),a.strokeStyle="black",a.beginPath(),d=0;d<h;d++)a.moveTo(.5+(1/(h-1)*d*256|0),0),a.lineTo(.5+(1/(h-1)*d*256|0),d==0?15:5);return a.moveTo(255.5,0),a.lineTo(255.5,15),a.moveTo(255.5,4.5),a.lineTo(0,4.5),a.stroke(),o.set("ctx",a),g.toDataURL()},getElement:function(){return this.get("element")},update:function(t){for(var o,s,h=this,g=h.get("gradientArr"),a=h.get("ctx"),d=h.get("labelsEl"),f="",y=0;y<g.length;y++)o=t*g[y].stop|0,s=a.measureText(o).width/2|0,y==0&&(s=0),y==g.length-1&&(s*=2),f+='<li style="position:absolute;left:'+((0|(1/(g.length-1)*y*256||0))-s+.5)+'px">'+o+"</li>";d.innerHTML=f}};var i=function(t){var o={radius:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},legend:null,visible:!0,width:0,height:0,max:!1,gradient:!1,opacity:180,premultiplyAlpha:!1,bounds:{l:1e3,r:0,t:1e3,b:0},debug:!1};this.store=new l(this),this.get=function(s){return o[s]},this.set=function(s,h){o[s]=h},this.configure(t),this.init()};return i.prototype={configure:function(t){var o=this;if(o.set("radius",t.radius||40),o.set("element",t.element instanceof Object?t.element:document.getElementById(t.element)),o.set("visible",t.visible==null||t.visible),o.set("max",t.max||!1),o.set("gradient",t.gradient||{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}),o.set("opacity",parseInt(255/(100/t.opacity),10)||180),o.set("width",t.width||0),o.set("height",t.height||0),o.set("debug",t.debug),t.legend){var s=t.legend;s.gradient=o.get("gradient"),o.set("legend",new u(s))}},resize:function(){var t=this,o=t.get("element"),s=t.get("canvas"),h=t.get("acanvas");s.width=h.width=t.get("width")||o.style.width.replace(/px/,"")||t.getWidth(o),this.set("width",s.width),s.height=h.height=t.get("height")||o.style.height.replace(/px/,"")||t.getHeight(o),this.set("height",s.height)},init:function(){var t=this,o=document.createElement("canvas"),s=document.createElement("canvas"),h=o.getContext("2d"),g=s.getContext("2d"),a=t.get("element");t.initColorPalette(),t.set("canvas",o),t.set("ctx",h),t.set("acanvas",s),t.set("actx",g),t.resize(),o.style.cssText=s.style.cssText="position:absolute;top:0;left:0;z-index:10000000;",t.get("visible")||(o.style.display="none"),a.appendChild(o),t.get("legend")&&a.appendChild(t.get("legend").getElement()),t.get("debug")&&document.body.appendChild(s),g.shadowOffsetX=15e3,g.shadowOffsetY=15e3,g.shadowBlur=15},initColorPalette:function(){var t,o,s,h=this,g=document.createElement("canvas"),a=h.get("gradient");for(var d in g.width="1",g.height="256",o=(t=g.getContext("2d")).createLinearGradient(0,0,1,256),(s=t.getImageData(0,0,1,1)).data[0]=s.data[3]=64,s.data[1]=s.data[2]=0,t.putImageData(s,0,0),s=t.getImageData(0,0,1,1),h.set("premultiplyAlpha",s.data[0]<60||s.data[0]>70),a)o.addColorStop(d,a[d]);t.fillStyle=o,t.fillRect(0,0,1,256),h.set("gradient",t.getImageData(0,0,1,256).data)},getWidth:function(t){var o=t.offsetWidth;return t.style.paddingLeft&&(o+=t.style.paddingLeft),t.style.paddingRight&&(o+=t.style.paddingRight),o},getHeight:function(t){var o=t.offsetHeight;return t.style.paddingTop&&(o+=t.style.paddingTop),t.style.paddingBottom&&(o+=t.style.paddingBottom),o},colorize:function(t,o){var s,h,g,a,d,f,y,x,c,w=this,C=w.get("width"),P=w.get("radius"),M=w.get("height"),r=w.get("actx"),m=w.get("ctx"),v=3*P,b=w.get("premultiplyAlpha"),_=w.get("gradient"),B=w.get("opacity"),k=w.get("bounds");t!=null&&o!=null?(t+v>C&&(t=C-v),t<0&&(t=0),o<0&&(o=0),o+v>M&&(o=M-v),s=t,h=o,a=t+v,g=o+v):(s=k.l<0?0:k.l,a=k.r>C?C:k.r,h=k.t<0?0:k.t,g=k.b>M?M:k.b),f=(d=r.getImageData(s,h,a-s,g-h)).data.length;for(var S=3;S<f;S+=4)(x=4*(y=d.data[S]))&&(c=y<B?y:B,d.data[S-3]=_[x],d.data[S-2]=_[x+1],d.data[S-1]=_[x+2],b&&(d.data[S-3]/=255/c,d.data[S-2]/=255/c,d.data[S-1]/=255/c),d.data[S]=c);m.putImageData(d,s,h)},drawAlpha:function(t,o,s,h){var g=this,a=g.get("radius"),d=g.get("actx");g.get("max");var f=g.get("bounds"),y=t-1.5*a|0,x=o-1.5*a|0,c=t+1.5*a|0,w=o+1.5*a|0;d.shadowColor="rgba(0,0,0,"+(s?s/g.store.max:"0.1")+")",d.shadowOffsetX=15e3,d.shadowOffsetY=15e3,d.shadowBlur=15,d.beginPath(),d.arc(t-15e3,o-15e3,a,0,2*Math.PI,!0),d.closePath(),d.fill(),h?g.colorize(y,x):(y<f.l&&(f.l=y),x<f.t&&(f.t=x),c>f.r&&(f.r=c),w>f.b&&(f.b=w))},toggleDisplay:function(){var t=this,o=t.get("visible"),s=t.get("canvas");s.style.display=o?"none":"block",t.set("visible",!o)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var t=this,o=t.get("width"),s=t.get("height");t.store.set("data",[]),t.get("ctx").clearRect(0,0,o,s),t.get("actx").clearRect(0,0,o,s)},cleanup:function(){var t=this;t.get("element").removeChild(t.get("canvas"))}},{create:function(t){return new i(t)},util:{mousePosition:function(t){var o,s;if(t.layerX?(o=t.layerX,s=t.layerY):t.offsetX&&(o=t.offsetX,s=t.offsetY),o!==void 0)return[o,s]}}}}(),p=function(l){try{BMap}catch{throw Error("Baidu Map JS API is not ready yet!")}if(!p._isExtended){p._isExtended=!0,e(p,BMap.Overlay,"HeatmapOverlay");var u=new p(l);this.__proto__=u.__proto__}this.conf=l,this.heatmap=null,this.latlngs=[],this.bounds=null,this._moveendHandler=this._moveendHandler.bind(this)};p.prototype.initialize=function(l){this._map=l;var u=document.createElement("div");return u.style.position="absolute",u.style.top=0,u.style.left=0,u.style.border=0,u.style.width=this._map.getSize().width+"px",u.style.height=this._map.getSize().height+"px",this.conf.element=u,l.getPanes().mapPane.appendChild(u),this.heatmap=n.create(this.conf),this._div=u,u},p.prototype.draw=function(){var l=this._map.getBounds();if(!l.equals(this.bounds)){this.bounds=l;var u=this._map.pointToOverlayPixel(l.getNorthEast()),i=this._map.pointToOverlayPixel(l.getSouthWest());if(u&&i){var t=u.y,o=i.x,s=i.y-u.y,h=u.x-i.x;if(this.conf.element.style.left=o+"px",this.conf.element.style.top=t+"px",this.conf.element.style.width=h+"px",this.conf.element.style.height=s+"px",this.heatmap.store.get("heatmap").resize(),this.latlngs.length>0){this.heatmap.clear();for(var g=this.latlngs.length,a={max:this.heatmap.store.max,data:[]};g--;){var d=this.latlngs[g].latlng;if(l.containsPoint(d)){var f=this._map.pointToOverlayPixel(d),y=new BMap.Pixel(f.x-o,f.y-t),x=this.pixelTransform(y);a.data.push({x:x.x,y:x.y,count:this.latlngs[g].c})}}this.heatmap.store.setDataSet(a)}}}},p.prototype.pixelTransform=function(l){for(var u=this.heatmap.get("width"),i=this.heatmap.get("height");l.x<0;)l.x+=u;for(;l.x>u;)l.x-=u;for(;l.y<0;)l.y+=i;for(;l.y>i;)l.y-=i;return l.x=0|l.x,l.y=0|l.y,l},p.prototype._moveendHandler=function(l){this.setDataSet(this._data),delete this._data,this._map.removeEventListener("moveend",this._moveendHandler)},p.prototype.setDataSet=function(l){if(this._map){var u=this._map.getBounds(),i=this._map.pointToOverlayPixel(u.getNorthEast()),t=this._map.pointToOverlayPixel(u.getSouthWest());i&&t||(this._data=l,this._map.addEventListener("moveend",this._moveendHandler));var o={max:l.max,data:[]},s=l.data,h=s.length;for(this.latlngs=[];h--;){var g=new BMap.Point(s[h].lng,s[h].lat);if(this.latlngs.push({latlng:g,c:s[h].count}),u.containsPoint(g)){var a=this._map.pointToOverlayPixel(g),d=this._map.pointToOverlayPixel(u.getSouthWest()).x,f=this._map.pointToOverlayPixel(u.getNorthEast()).y,y=new BMap.Pixel(a.x-d,a.y-f),x=this.pixelTransform(y);o.data.push({x:x.x,y:x.y,count:s[h].count})}}this.heatmap.clear(),this.heatmap.store.setDataSet(o)}},p.prototype.addDataPoint=function(l,u,i){var t=new BMap.Point(l,u),o=this.pixelTransform(this._map.pointToOverlayPixel(t));this.heatmap.store.addDataPoint(o.x,o.y,i),this.latlngs.push({latlng:t,c:i})},p.prototype.toggle=function(){this.heatmap.toggleDisplay()}}();const Lt=_t(ut({__name:"map",emits:["mapConfirm"],setup(e,{expose:n,emit:p}){const l=mt(),u=E("m1YRfvvQt9dPVNuPSieTEDgRhZkIznSn"),i=E(15),t=E({}),o=E({lng:116.404,lat:39.915}),s=E({point:{},address:"",province:"",city:"",district:"",addr:""}),h=E(!1),g=E("\u5730\u56FE\u9009\u62E9"),a=E("");n({open:async()=>{h.value=!0}});const d=w=>{t.value=w.BMap,t.value&&new t.value.Geolocation().getCurrentPosition(C=>{if(C){const{lng:P,lat:M}=C.point,{province:r,city:m,district:v,street:b,street_number:_}=C.address;o.value={lng:P,lat:M},s.value={province:r,city:m,district:v,addr:b+_,lng:P,lat:M}}})},f=w=>{o.value.lng=w.point.lng,o.value.lat=w.point.lat,t.value&&new t.value.Geocoder().getLocation(w.point,function(C){const P=C.addressComponents,M=C.surroundingPois,r=P.province,m=P.city,v=P.district,b=w.point,_=C.address;let B=P.street;M.length>0&&M[0].title?B+=B?`-${M[0].title}`:`${M[0].title}`:B+=P.streetNumber,s.value={point:b,address:_,province:r,city:m,district:v,addr:B,...o.value}})},y=w=>{i.value=w.target.getZoom()},x=p,c=()=>{if(s.value.address=="")return l.error("\u8BF7\u9009\u62E9\u5B9A\u4F4D\u5730\u5740");h.value=!1,x("mapConfirm",s.value)};return(w,C)=>{const P=gt("bm-view"),M=yt,r=vt,m=st;return L(),ft(m,{title:I(g),modelValue:I(h),"onUpdate:modelValue":C[3]||(C[3]=v=>U(h)?h.value=v:null)},{footer:D(()=>[O(r,{onClick:C[2]||(C[2]=v=>h.value=!1)},{default:D(()=>[et("\u53D6 \u6D88")]),_:1}),O(r,{icon:"el-icon-place",type:"primary",onClick:c},{default:D(()=>[et("\u786E \u5B9A")]),_:1})]),default:D(()=>[O(I(kt),{style:{height:"400px",width:"100%"},ak:I(u),"map-click":!1,center:I(o),zoom:I(i),"scroll-wheel-zoom":!0,onClick:f,onMoving:y,onMoveend:y,onReady:d,onZoomend:y},{default:D(()=>[O(P,{style:{width:"100%",height:"100%"}}),O(I(Tt),{position:{lng:I(o).lng,lat:I(o).lat},dragging:!0,animation:"BMAP_ANIMATION_BOUNCE"},null,8,["position"]),O(I(It),{offset:{width:"10px",height:"10px"}},{default:D(()=>[O(I(zt),{modelValue:I(a),"onUpdate:modelValue":C[1]||(C[1]=v=>U(a)?a.value=v:null),"sug-style":{zIndex:999999}},{default:D(()=>[O(M,{modelValue:I(a),"onUpdate:modelValue":C[0]||(C[0]=v=>U(a)?a.value=v:null),type:"text",placeholder:"\u8BF7\u8F93\u5165\u5730\u540D\u5173\u952E\u5B57",clearable:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),O(I(Pt),{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","show-address-bar":"","auto-location":""}),O(I(Ot),{keyword:I(a),"auto-viewport":!0,panel:!1},null,8,["keyword"])]),_:1},8,["ak","center","zoom"])]),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-a6bf808d"]]);export{Lt as default};
